/* ArtistAPhoto - Browser Image Editor SDK */
var Vt=Object.defineProperty;var l=(s,e)=>()=>(s&&(e=s(s=0)),e);var Kt=(s,e)=>{for(var t in e)Vt(s,t,{get:e[t],enumerable:true});};var O,ut=l(()=>{O=class s{constructor(e,t){this.originalImage=e,this.originalImageData=t,this.width=t.width,this.height=t.height,this.metadata={createdAt:Date.now(),format:"unknown",width:t.width,height:t.height};}clone(){return new s(this.originalImage,this.originalImageData)}};});var Q,ht=l(()=>{Q=class{constructor(){this.operations=[];this.currentIndex=-1;}enqueue(e){this.operations=this.operations.slice(0,this.currentIndex+1),this.operations.push(e),this.currentIndex++;}undo(){this.canUndo()&&this.currentIndex--;}redo(){this.canRedo()&&this.currentIndex++;}getActiveOperations(){return this.operations.slice(0,this.currentIndex+1)}getAllOperations(){return this.operations}canUndo(){return this.currentIndex>=0}canRedo(){return this.currentIndex<this.operations.length-1}clear(){this.operations=[],this.currentIndex=-1;}reset(){this.currentIndex=-1;}};});var P,D,k,L,U,j,H=l(()=>{P=class s extends Error{constructor(e){super(e),this.name="ArtistAPhotoError",Object.setPrototypeOf(this,s.prototype);}},D=class s extends P{constructor(e="Invalid dimensions"){super(e),this.name="InvalidDimensionsError",Object.setPrototypeOf(this,s.prototype);}},k=class s extends P{constructor(e="Invalid crop parameters"){super(e),this.name="InvalidCropError",Object.setPrototypeOf(this,s.prototype);}},L=class s extends P{constructor(e="Failed to load image"){super(e),this.name="ImageLoadError",Object.setPrototypeOf(this,s.prototype);}},U=class s extends P{constructor(e="Failed to export image"){super(e),this.name="ExportError",Object.setPrototypeOf(this,s.prototype);}},j=class s extends P{constructor(e="Failed to get canvas context"){super(e),this.name="CanvasContextError",Object.setPrototypeOf(this,s.prototype);}};});function R(s,e){let t=document.createElement("canvas");return t.width=s,t.height=e,t}function T(s){let e=s.getContext("2d",{willReadFrequently:true});if(!e)throw new j("Failed to get 2D context");return e}function yt(s,e="image/png",t){return new Promise((r,o)=>{s.toBlob(n=>{n?r(n):o(new U("Failed to create blob from canvas"));},e,t);})}function dt(s,e="image/png",t){return s.toDataURL(e,t)}function gt(s,e){let t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=e,r.click(),URL.revokeObjectURL(t);}var B=l(()=>{H();});var S,ft=l(()=>{B();S=class{constructor(){this.canvas=R(1,1),this.ctx=T(this.canvas);}async execute(e,t){this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e.originalImage,0,0);for(let r of t)await r.apply(this.canvas,this.ctx);return this.canvas}getCanvas(){return this.canvas}getContext(){return this.ctx}};});async function pt(s){return new Promise((e,t)=>{let r=new Image;r.crossOrigin="anonymous",r.onload=()=>e(r),r.onerror=()=>t(new L(`Failed to load image from ${s}`)),r.src=s;})}async function bt(s){let e=URL.createObjectURL(s);try{return await pt(e)}finally{URL.revokeObjectURL(e);}}function W(s){let e=R(s.width,s.height),t=T(e);return t.drawImage(s,0,0),t.getImageData(0,0,s.width,s.height)}var xt=l(()=>{H();B();});function vt(s,e){if(s<=0||e<=0)throw new D("Dimensions must be positive numbers");if(s>q||e>q)throw new D(`Dimensions exceed maximum size (${q}x${q})`)}function wt(s,e,t){let{x:r,y:o,width:n,height:a}=s;if(r<0||o<0)throw new k("Crop coordinates must be non-negative");if(n<=0||a<=0)throw new k("Crop dimensions must be positive");if(r+n>e||o+a>t)throw new k("Crop area exceeds image bounds")}function w(s,e=-100,t=100){return Math.max(e,Math.min(t,s))}function Ct(s=1){return Math.max(0,Math.min(1,s))}var q,M=l(()=>{H();q=16384;});var b,I=l(()=>{b=class{validate(){return  true}};});var z,It=l(()=>{I();z=class extends b{constructor(t){super();this.type="crop";this.params=t;}async apply(t,r){let{x:o,y:n,width:a,height:i}=this.params,m=r.getImageData(o,n,a,i);t.width=a,t.height=i,r.putImageData(m,0,0);}validate(){let{x:t,y:r,width:o,height:n}=this.params;return t>=0&&r>=0&&o>0&&n>0}};});var N,Pt=l(()=>{I();B();N=class extends b{constructor(t,r,o){super();this.type="resize";this.params={width:t,height:r,quality:o?.quality||"high",maintainAspectRatio:o?.maintainAspectRatio??true};}async apply(t,r){let{width:o,height:n,quality:a}=this.params,i=r.getImageData(0,0,t.width,t.height),m=R(t.width,t.height);T(m).putImageData(i,0,0),t.width=o,t.height=n,r.imageSmoothingEnabled=a==="high"||a==="medium",r.imageSmoothingQuality=a==="high"?"high":a==="medium"?"medium":"low",r.drawImage(m,0,0,o,n);}validate(){let{width:t,height:r}=this.params;return t>0&&r>0}};});var g,x=l(()=>{I();M();g=class extends b{constructor(t=1){super();this.type="filter";this.intensity=Ct(t);}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data;this.applyFilter(n,t.width,t.height),r.putImageData(o,0,0);}};});var V,Mt=l(()=>{x();V=class extends g{constructor(t=1){super(t);this.params={filterType:"grayscale"};this.params={filterType:"grayscale",intensity:this.intensity};}applyFilter(t){for(let r=0;r<t.length;r+=4){let o=t[r]*.299+t[r+1]*.587+t[r+2]*.114;t[r]=t[r]*(1-this.intensity)+o*this.intensity,t[r+1]=t[r+1]*(1-this.intensity)+o*this.intensity,t[r+2]=t[r+2]*(1-this.intensity)+o*this.intensity;}}};});function p(s,e=0,t=255){return Math.max(e,Math.min(t,s))}var C=l(()=>{});var K,Et=l(()=>{x();C();K=class extends g{constructor(t=1){super(t);this.params={filterType:"sepia"};this.params={filterType:"sepia",intensity:this.intensity};}applyFilter(t){for(let r=0;r<t.length;r+=4){let o=t[r],n=t[r+1],a=t[r+2],i=o*.393+n*.769+a*.189,m=o*.349+n*.686+a*.168,d=o*.272+n*.534+a*.131;t[r]=p(t[r]*(1-this.intensity)+i*this.intensity),t[r+1]=p(t[r+1]*(1-this.intensity)+m*this.intensity),t[r+2]=p(t[r+2]*(1-this.intensity)+d*this.intensity);}}};});function X(s,e,t,r,o){let n=new Uint8ClampedArray(s.length),a=Math.floor(o/2);for(let i=0;i<t;i++)for(let m=0;m<e;m++){let d=0,h=0,c=0;for(let y=0;y<o;y++)for(let f=0;f<o;f++){let v=Math.min(t-1,Math.max(0,i+y-a)),A=Math.min(e-1,Math.max(0,m+f-a)),F=(v*e+A)*4,E=r[y*o+f];d+=s[F]*E,h+=s[F+1]*E,c+=s[F+2]*E;}let u=(i*e+m)*4;n[u]=Math.max(0,Math.min(255,d)),n[u+1]=Math.max(0,Math.min(255,h)),n[u+2]=Math.max(0,Math.min(255,c)),n[u+3]=s[u+3];}return n}var Ot,kt,At,Dt,_=l(()=>{Ot=[1/16,2/16,1/16,2/16,4/16,2/16,1/16,2/16,1/16],kt=[0,-1,0,-1,5,-1,0,-1,0],At=[-1,0,1,-2,0,2,-1,0,1],Dt=[-1,-2,-1,0,0,0,1,2,1];});var G,Rt=l(()=>{x();_();G=class extends g{constructor(e=1,t=1){super(e),this.params={filterType:"blur",intensity:this.intensity,radius:t};}applyFilter(e,t,r){let o=X(e,t,r,Ot,3);for(let n=0;n<e.length;n++)(n+1)%4!==0&&(e[n]=e[n]*(1-this.intensity)+o[n]*this.intensity);}};});var Y,Tt=l(()=>{x();_();Y=class extends g{constructor(e=1){super(e),this.params={filterType:"sharpen",intensity:this.intensity};}applyFilter(e,t,r){let o=X(e,t,r,kt,3);for(let n=0;n<e.length;n++)(n+1)%4!==0&&(e[n]=e[n]*(1-this.intensity)+o[n]*this.intensity);}};});var $,Ft=l(()=>{x();C();$=class extends g{constructor(e=1){super(e),this.params={filterType:"vintage",intensity:this.intensity};}applyFilter(e,t,r){for(let o=0;o<r;o++)for(let n=0;n<t;n++){let a=(o*t+n)*4,i=e[a],m=e[a+1],d=e[a+2],h=i*.9+30,c=m*.85+10,u=d*.7,y=(h+c+u)/3;h=h*.8+y*.2,c=c*.8+y*.2,u=u*.8+y*.2;let f=t/2,v=r/2,A=Math.sqrt(Math.pow(n-f,2)+Math.pow(o-v,2)),F=Math.sqrt(Math.pow(f,2)+Math.pow(v,2)),E=1-A/F*.5;h*=E,c*=E,u*=E,e[a]=p(e[a]*(1-this.intensity)+h*this.intensity),e[a+1]=p(e[a+1]*(1-this.intensity)+c*this.intensity),e[a+2]=p(e[a+2]*(1-this.intensity)+u*this.intensity);}}};});var J,Lt=l(()=>{x();J=class extends g{constructor(t=1){super(t);this.params={filterType:"invert"};this.params={filterType:"invert",intensity:this.intensity};}applyFilter(t){for(let r=0;r<t.length;r+=4)t[r]=t[r]*(1-this.intensity)+(255-t[r])*this.intensity,t[r+1]=t[r+1]*(1-this.intensity)+(255-t[r+1])*this.intensity,t[r+2]=t[r+2]*(1-this.intensity)+(255-t[r+2])*this.intensity;}};});var Z,Ut=l(()=>{x();Z=class extends g{constructor(e=1,t=.5){super(e),this.params={filterType:"vignette",intensity:this.intensity,strength:Math.max(0,Math.min(1,t))};}applyFilter(e,t,r){let o=t/2,n=r/2,a=Math.sqrt(o*o+n*n),i=this.params.strength||.5;for(let m=0;m<r;m++)for(let d=0;d<t;d++){let c=1-Math.sqrt(Math.pow(d-o,2)+Math.pow(m-n,2))/a*i,u=Math.max(0,Math.min(1,c)),y=(m*t+d)*4,f=e[y],v=e[y+1],A=e[y+2];e[y]=f*(1-this.intensity)+f*u*this.intensity,e[y+1]=v*(1-this.intensity)+v*u*this.intensity,e[y+2]=A*(1-this.intensity)+A*u*this.intensity;}}};});var tt,jt=l(()=>{x();C();tt=class extends g{constructor(e=1,t=4){super(e),this.params={filterType:"posterize",intensity:this.intensity,levels:Math.max(2,Math.min(16,Math.floor(t)))};}applyFilter(e){let r=255/((this.params.levels||4)-1);for(let o=0;o<e.length;o+=4){let n=e[o],a=e[o+1],i=e[o+2],m=Math.round(n/r)*r,d=Math.round(a/r)*r,h=Math.round(i/r)*r;e[o]=p(e[o]*(1-this.intensity)+m*this.intensity),e[o+1]=p(e[o+1]*(1-this.intensity)+d*this.intensity),e[o+2]=p(e[o+2]*(1-this.intensity)+h*this.intensity);}}};});var et,Ht=l(()=>{x();et=class extends g{constructor(e=1,t=10){super(e),this.params={filterType:"pixelate",intensity:this.intensity,blockSize:Math.max(1,Math.floor(t))};}applyFilter(e,t,r){let o=this.params.blockSize||10,n=new Uint8ClampedArray(e);for(let a=0;a<r;a+=o)for(let i=0;i<t;i+=o){let m=this.getBlockAverage(n,i,a,o,t,r);this.fillBlock(e,n,i,a,o,t,r,m);}}getBlockAverage(e,t,r,o,n,a){let i=0,m=0,d=0,h=0;for(let c=r;c<Math.min(r+o,a);c++)for(let u=t;u<Math.min(t+o,n);u++){let y=(c*n+u)*4;i+=e[y],m+=e[y+1],d+=e[y+2],h++;}return [Math.round(i/h),Math.round(m/h),Math.round(d/h)]}fillBlock(e,t,r,o,n,a,i,m){let[d,h,c]=m;for(let u=o;u<Math.min(o+n,i);u++)for(let y=r;y<Math.min(r+n,a);y++){let f=(u*a+y)*4;e[f]=t[f]*(1-this.intensity)+d*this.intensity,e[f+1]=t[f+1]*(1-this.intensity)+h*this.intensity,e[f+2]=t[f+2]*(1-this.intensity)+c*this.intensity;}}};});var rt,Bt=l(()=>{x();_();C();rt=class extends g{constructor(e=1){super(e),this.params={filterType:"edgeDetection",intensity:this.intensity};}applyFilter(e,t,r){let o=new Uint8ClampedArray(e.length);for(let a=0;a<e.length;a+=4){let i=e[a]*.299+e[a+1]*.587+e[a+2]*.114;o[a]=o[a+1]=o[a+2]=i,o[a+3]=e[a+3];}let n=this.applySobel(o,t,r);for(let a=0;a<e.length;a+=4)e[a]=e[a]*(1-this.intensity)+n[a]*this.intensity,e[a+1]=e[a+1]*(1-this.intensity)+n[a+1]*this.intensity,e[a+2]=e[a+2]*(1-this.intensity)+n[a+2]*this.intensity;}applySobel(e,t,r){let o=new Uint8ClampedArray(e.length);for(let n=1;n<r-1;n++)for(let a=1;a<t-1;a++){let i=0,m=0;for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++){let y=((n+c)*t+(a+u))*4,f=(c+1)*3+(u+1),v=e[y];i+=v*At[f],m+=v*Dt[f];}let d=Math.sqrt(i*i+m*m),h=(n*t+a)*4;o[h]=o[h+1]=o[h+2]=p(d),o[h+3]=e[h+3];}return o}};});var nt,Wt=l(()=>{I();M();C();nt=class extends b{constructor(t){super();this.type="adjustment";this.params={adjustment:"brightness",value:w(t)};}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data,a=this.params.value*2.55;for(let i=0;i<n.length;i+=4)n[i]=p(n[i]+a),n[i+1]=p(n[i+1]+a),n[i+2]=p(n[i+2]+a);r.putImageData(o,0,0);}};});var ot,Qt=l(()=>{I();M();C();ot=class extends b{constructor(t){super();this.type="adjustment";this.params={adjustment:"contrast",value:w(t)};}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data,a=259*(this.params.value+255)/(255*(259-this.params.value));for(let i=0;i<n.length;i+=4)n[i]=p(a*(n[i]-128)+128),n[i+1]=p(a*(n[i+1]-128)+128),n[i+2]=p(a*(n[i+2]-128)+128);r.putImageData(o,0,0);}};});var st,St=l(()=>{I();M();C();st=class extends b{constructor(t){super();this.type="adjustment";this.params={adjustment:"saturation",value:w(t)};}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data,a=(this.params.value+100)/100;for(let i=0;i<n.length;i+=4){let m=n[i],d=n[i+1],h=n[i+2],c=.299*m+.587*d+.114*h;n[i]=p(c+a*(m-c)),n[i+1]=p(c+a*(d-c)),n[i+2]=p(c+a*(h-c));}r.putImageData(o,0,0);}};});var at,qt=l(()=>{I();M();C();at=class extends b{constructor(t){super();this.type="adjustment";this.params={adjustment:"exposure",value:w(t)};}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data,a=this.params.value/100,i=Math.pow(2,a);for(let m=0;m<n.length;m+=4)n[m]=p(n[m]*i),n[m+1]=p(n[m+1]*i),n[m+2]=p(n[m+2]*i);r.putImageData(o,0,0);}};});var it,zt=l(()=>{I();M();C();it=class extends b{constructor(t){super();this.type="adjustment";this.params={adjustment:"temperature",value:w(t)};}async apply(t,r){let o=r.getImageData(0,0,t.width,t.height),n=o.data,a=this.params.value/100;for(let i=0;i<n.length;i+=4)a>0?(n[i]=p(n[i]+a*40),n[i+2]=p(n[i+2]-a*40)):(n[i]=p(n[i]+a*40),n[i+2]=p(n[i+2]-a*40));r.putImageData(o,0,0);}};});var Nt={};Kt(Nt,{ArtistAPhoto:()=>mt});var mt,lt=l(()=>{ut();ht();ft();xt();B();M();It();Pt();Mt();Et();Rt();Tt();Ft();Lt();Ut();jt();Ht();Bt();Wt();Qt();St();qt();zt();mt=class s{constructor(e){this.state=e,this.operationQueue=new Q,this.processor=new S;}static async fromUrl(e){let t=await pt(e),r=W(t),o=new O(t,r);return new s(o)}static async fromFile(e){let t=await bt(e),r=W(t),o=new O(t,r);return new s(o)}static async fromCanvas(e){let t=new Image;t.src=e.toDataURL(),await new Promise(n=>t.onload=n);let r=W(t),o=new O(t,r);return new s(o)}static async fromImageElement(e){let t=W(e),r=new O(e,t);return new s(r)}crop(e){wt(e,this.state.width,this.state.height);let t=new z(e);return this.operationQueue.enqueue(t),this}resize(e,t,r){vt(e,t);let o=new N(e,t,r);return this.operationQueue.enqueue(o),this}filter(e,t=1){let r;switch(e){case "grayscale":r=new V(t);break;case "sepia":r=new K(t);break;case "blur":r=new G(t);break;case "sharpen":r=new Y(t);break;case "vintage":r=new $(t);break;case "invert":r=new J(t);break;case "vignette":r=new Z(t);break;case "posterize":r=new tt(t);break;case "pixelate":r=new et(t);break;case "edgeDetection":r=new rt(t);break}return this.operationQueue.enqueue(r),this}brightness(e){let t=new nt(e);return this.operationQueue.enqueue(t),this}contrast(e){let t=new ot(e);return this.operationQueue.enqueue(t),this}saturation(e){let t=new st(e);return this.operationQueue.enqueue(t),this}exposure(e){let t=new at(e);return this.operationQueue.enqueue(t),this}temperature(e){let t=new it(e);return this.operationQueue.enqueue(t),this}undo(){return this.operationQueue.undo(),this}redo(){return this.operationQueue.redo(),this}canUndo(){return this.operationQueue.canUndo()}canRedo(){return this.operationQueue.canRedo()}getHistory(){return this.operationQueue.getAllOperations()}reset(){return this.operationQueue.reset(),this}getOriginal(){return this.state.originalImageData}async preview(){let e=this.operationQueue.getActiveOperations();return await this.processor.execute(this.state,e)}async toCanvas(){return await this.preview()}async toBlob(e,t){let r=await this.toCanvas();return await yt(r,e,t)}async toDataURL(e,t){let r=await this.toCanvas();return dt(r,e,t)}async download(e,t,r){let o=await this.toBlob(t,r);gt(o,e);}};});lt();H();var ct=class{constructor(e){this.workers=[];this.availableWorkers=[];this.workerUrl=null;this.maxWorkers=e||navigator.hardwareConcurrency||4;}createWorker(){if(!this.workerUrl){let t=`
        // Inline worker code would go here
        // For now, this is a placeholder
        self.onmessage = function(e) {
          self.postMessage({ result: e.data.imageData });
        };
      `,r=new Blob([t],{type:"application/javascript"});this.workerUrl=URL.createObjectURL(r);}let e=new Worker(this.workerUrl);return this.workers.push(e),e}async getAvailableWorker(){return this.availableWorkers.length>0?this.availableWorkers.pop():this.workers.length<this.maxWorkers?this.createWorker():new Promise(e=>{let t=setInterval(()=>{this.availableWorkers.length>0&&(clearInterval(t),e(this.availableWorkers.pop()));},10);})}releaseWorker(e){this.availableWorkers.push(e);}async execute(e){let t=await this.getAvailableWorker();return new Promise((r,o)=>{let n=setTimeout(()=>{this.releaseWorker(t),o(new Error("Worker timeout"));},3e4);t.onmessage=a=>{clearTimeout(n),this.releaseWorker(t),r(a.data);},t.onerror=a=>{clearTimeout(n),this.releaseWorker(t),o(a);},t.postMessage(e);})}terminate(){this.workers.forEach(e=>e.terminate()),this.workers=[],this.availableWorkers=[],this.workerUrl&&(URL.revokeObjectURL(this.workerUrl),this.workerUrl=null);}};async function Lr(s){let{ArtistAPhoto:e}=await Promise.resolve().then(()=>(lt(),Nt));if(typeof s=="string")return e.fromUrl(s);if(s instanceof File)return e.fromFile(s);if(s instanceof HTMLImageElement)return e.fromImageElement(s);if(s instanceof HTMLCanvasElement)return e.fromCanvas(s);throw new Error("Unsupported source type")}export{mt as ArtistAPhoto,P as ArtistAPhotoError,j as CanvasContextError,U as ExportError,L as ImageLoadError,k as InvalidCropError,D as InvalidDimensionsError,ct as WorkerPool,Lr as createEditor};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map