{"version":3,"sources":["../src/workers/imageWorker.ts"],"names":["convolve","data","width","height","kernel","kernelSize","result","half","y","x","b","ky","kx","pixelY","pixelX","pixelIndex","weight","index","applyBlur","imageData","newImageData","applySharpen","applyEdgeDetection","sobelX","sobelY","gray","i","grayValue","gx","gy","kernelIndex","pixelValue","magnitude","applyPixelate","blockSize","r","g","count","dy","dx","type","params","response","error"],"mappings":";AAeA,SAASA,EACPC,CAAAA,CACAC,CAAAA,CACAC,EACAC,CAAAA,CACAC,CAAAA,CACmB,CACnB,IAAMC,CAAAA,CAAS,IAAI,iBAAA,CAAkBL,EAAK,MAAM,CAAA,CAC1CM,EAAO,IAAA,CAAK,KAAA,CAAMF,EAAa,CAAC,CAAA,CAEtC,IAAA,IAASG,CAAAA,CAAI,EAAGA,CAAAA,CAAIL,CAAAA,CAAQK,IAC1B,IAAA,IAASC,CAAAA,CAAI,EAAGA,CAAAA,CAAIP,CAAAA,CAAOO,IAAK,CAC9B,IAAI,EAAI,CAAA,CACN,CAAA,CAAI,EACJC,CAAAA,CAAI,CAAA,CAEN,QAASC,CAAAA,CAAK,CAAA,CAAGA,CAAAA,CAAKN,CAAAA,CAAYM,IAChC,IAAA,IAASC,CAAAA,CAAK,EAAGA,CAAAA,CAAKP,CAAAA,CAAYO,IAAM,CACtC,IAAMC,EAAS,IAAA,CAAK,GAAA,CAAIV,EAAS,CAAA,CAAG,IAAA,CAAK,IAAI,CAAA,CAAGK,CAAAA,CAAIG,EAAKJ,CAAI,CAAC,CAAA,CACxDO,CAAAA,CAAS,KAAK,GAAA,CAAIZ,CAAAA,CAAQ,EAAG,IAAA,CAAK,GAAA,CAAI,EAAGO,CAAAA,CAAIG,CAAAA,CAAKL,CAAI,CAAC,CAAA,CACvDQ,GAAcF,CAAAA,CAASX,CAAAA,CAAQY,GAAU,CAAA,CACzCE,CAAAA,CAASZ,EAAOO,CAAAA,CAAKN,CAAAA,CAAaO,CAAE,CAAA,CAE1C,GAAKX,CAAAA,CAAKc,CAAU,EAAIC,CAAAA,CACxB,CAAA,EAAKf,EAAKc,CAAAA,CAAa,CAAC,CAAA,CAAIC,CAAAA,CAC5BN,GAAKT,CAAAA,CAAKc,CAAAA,CAAa,CAAC,CAAA,CAAIC,EAC9B,CAGF,IAAMC,CAAAA,CAAAA,CAAST,CAAAA,CAAIN,CAAAA,CAAQO,GAAK,CAAA,CAChCH,CAAAA,CAAOW,CAAK,CAAA,CAAI,IAAA,CAAK,IAAI,CAAA,CAAG,IAAA,CAAK,IAAI,GAAA,CAAK,CAAC,CAAC,CAAA,CAC5CX,CAAAA,CAAOW,EAAQ,CAAC,CAAA,CAAI,KAAK,GAAA,CAAI,CAAA,CAAG,IAAA,CAAK,GAAA,CAAI,IAAK,CAAC,CAAC,EAChDX,CAAAA,CAAOW,CAAAA,CAAQ,CAAC,CAAA,CAAI,IAAA,CAAK,IAAI,CAAA,CAAG,IAAA,CAAK,IAAI,GAAA,CAAKP,CAAC,CAAC,CAAA,CAChDJ,CAAAA,CAAOW,EAAQ,CAAC,CAAA,CAAIhB,CAAAA,CAAKgB,CAAAA,CAAQ,CAAC,EACpC,CAGF,OAAOX,CACT,CAEA,SAASY,CAAAA,CAAUC,CAAAA,CAAiC,CAClD,IAAMf,CAAAA,CAAS,CAAC,KAAA,CAAQ,IAAA,CAAQ,MAAQ,IAAA,CAAQ,GAAA,CAAQ,KAAQ,KAAA,CAAQ,IAAA,CAAQ,KAAM,CAAA,CAChFE,EAASN,CAAAA,CAASmB,CAAAA,CAAU,KAAMA,CAAAA,CAAU,KAAA,CAAOA,EAAU,MAAA,CAAQf,CAAAA,CAAQ,CAAC,CAAA,CAC9EgB,EAAe,IAAI,SAAA,CAAUD,EAAU,KAAA,CAAOA,CAAAA,CAAU,MAAM,CAAA,CACpE,OAAAC,CAAAA,CAAa,IAAA,CAAK,IAAId,CAAM,CAAA,CACrBc,CACT,CAEA,SAASC,EAAaF,CAAAA,CAAiC,CACrD,IAAMf,CAAAA,CAAS,CAAC,EAAG,EAAA,CAAI,CAAA,CAAG,GAAI,CAAA,CAAG,EAAA,CAAI,EAAG,EAAA,CAAI,CAAC,CAAA,CACvCE,CAAAA,CAASN,EAASmB,CAAAA,CAAU,IAAA,CAAMA,EAAU,KAAA,CAAOA,CAAAA,CAAU,OAAQf,CAAAA,CAAQ,CAAC,EAC9EgB,CAAAA,CAAe,IAAI,UAAUD,CAAAA,CAAU,KAAA,CAAOA,EAAU,MAAM,CAAA,CACpE,OAAAC,CAAAA,CAAa,IAAA,CAAK,GAAA,CAAId,CAAM,EACrBc,CACT,CAEA,SAASE,CAAAA,CAAmBH,CAAAA,CAAiC,CAC3D,IAAMI,CAAAA,CAAS,CAAC,EAAA,CAAI,CAAA,CAAG,EAAG,EAAA,CAAI,CAAA,CAAG,EAAG,EAAA,CAAI,CAAA,CAAG,CAAC,CAAA,CACtCC,CAAAA,CAAS,CAAC,EAAA,CAAI,GAAI,EAAA,CAAI,CAAA,CAAG,EAAG,CAAA,CAAG,CAAA,CAAG,EAAG,CAAC,CAAA,CAEtCvB,CAAAA,CAAOkB,CAAAA,CAAU,KACjBjB,CAAAA,CAAQiB,CAAAA,CAAU,MAClBhB,CAAAA,CAASgB,CAAAA,CAAU,OACnBb,CAAAA,CAAS,IAAI,iBAAA,CAAkBL,CAAAA,CAAK,MAAM,CAAA,CAG1CwB,CAAAA,CAAO,IAAI,iBAAA,CAAkBxB,CAAAA,CAAK,MAAM,CAAA,CAC9C,IAAA,IAASyB,EAAI,CAAA,CAAGA,CAAAA,CAAIzB,EAAK,MAAA,CAAQyB,CAAAA,EAAK,EAAG,CACvC,IAAMC,EAAY1B,CAAAA,CAAKyB,CAAC,CAAA,CAAI,IAAA,CAAQzB,EAAKyB,CAAAA,CAAI,CAAC,EAAI,IAAA,CAAQzB,CAAAA,CAAKyB,EAAI,CAAC,CAAA,CAAI,KACxED,CAAAA,CAAKC,CAAC,EAAID,CAAAA,CAAKC,CAAAA,CAAI,CAAC,CAAA,CAAID,CAAAA,CAAKC,EAAI,CAAC,CAAA,CAAIC,CAAAA,CACtCF,CAAAA,CAAKC,EAAI,CAAC,CAAA,CAAIzB,EAAKyB,CAAAA,CAAI,CAAC,EAC1B,CAGA,IAAA,IAASlB,EAAI,CAAA,CAAGA,CAAAA,CAAIL,EAAS,CAAA,CAAGK,CAAAA,EAAAA,CAC9B,QAASC,CAAAA,CAAI,CAAA,CAAGA,EAAIP,CAAAA,CAAQ,CAAA,CAAGO,CAAAA,EAAAA,CAAK,CAClC,IAAImB,CAAAA,CAAK,CAAA,CACLC,EAAK,CAAA,CAET,IAAA,IAASlB,EAAK,EAAA,CAAIA,CAAAA,EAAM,CAAA,CAAGA,CAAAA,EAAAA,CACzB,QAASC,CAAAA,CAAK,EAAA,CAAIA,GAAM,CAAA,CAAGA,CAAAA,EAAAA,CAAM,CAC/B,IAAMG,CAAAA,CAAAA,CAAAA,CAAeP,CAAAA,CAAIG,CAAAA,EAAMT,GAASO,CAAAA,CAAIG,CAAAA,CAAAA,EAAO,EAC7CkB,CAAAA,CAAAA,CAAenB,CAAAA,CAAK,GAAK,CAAA,EAAKC,CAAAA,CAAK,GACnCmB,CAAAA,CAAaN,CAAAA,CAAKV,CAAU,CAAA,CAElCa,CAAAA,EAAMG,EAAaR,CAAAA,CAAOO,CAAW,EACrCD,CAAAA,EAAME,CAAAA,CAAaP,CAAAA,CAAOM,CAAW,EACvC,CAGF,IAAME,EAAY,IAAA,CAAK,IAAA,CAAKJ,EAAKA,CAAAA,CAAKC,CAAAA,CAAKA,CAAE,CAAA,CACvCZ,CAAAA,CAAAA,CAAST,EAAIN,CAAAA,CAAQO,CAAAA,EAAK,EAEhCH,CAAAA,CAAOW,CAAK,EAAIX,CAAAA,CAAOW,CAAAA,CAAQ,CAAC,CAAA,CAAIX,EAAOW,CAAAA,CAAQ,CAAC,EAAI,IAAA,CAAK,GAAA,CAAI,IAAKe,CAAS,CAAA,CAC/E1B,EAAOW,CAAAA,CAAQ,CAAC,EAAIhB,CAAAA,CAAKgB,CAAAA,CAAQ,CAAC,EACpC,CAGF,IAAMG,CAAAA,CAAe,IAAI,SAAA,CAAUlB,CAAAA,CAAOC,CAAM,CAAA,CAChD,OAAAiB,EAAa,IAAA,CAAK,GAAA,CAAId,CAAM,CAAA,CACrBc,CACT,CAEA,SAASa,EAAcd,CAAAA,CAAsBe,CAAAA,CAAoB,GAAe,CAC9E,IAAMjC,EAAO,IAAI,iBAAA,CAAkBkB,CAAAA,CAAU,IAAI,EAC3CjB,CAAAA,CAAQiB,CAAAA,CAAU,MAClBhB,CAAAA,CAASgB,CAAAA,CAAU,OAEzB,IAAA,IAASX,CAAAA,CAAI,EAAGA,CAAAA,CAAIL,CAAAA,CAAQK,GAAK0B,CAAAA,CAC/B,IAAA,IAASzB,EAAI,CAAA,CAAGA,CAAAA,CAAIP,EAAOO,CAAAA,EAAKyB,CAAAA,CAAW,CACzC,IAAIC,EAAI,CAAA,CACNC,CAAAA,CAAI,EACJ1B,CAAAA,CAAI,CAAA,CACJ2B,EAAQ,CAAA,CAGV,IAAA,IAASC,EAAK,CAAA,CAAGA,CAAAA,CAAKJ,GAAa1B,CAAAA,CAAI8B,CAAAA,CAAKnC,EAAQmC,CAAAA,EAAAA,CAClD,IAAA,IAASC,EAAK,CAAA,CAAGA,CAAAA,CAAKL,CAAAA,EAAazB,CAAAA,CAAI8B,EAAKrC,CAAAA,CAAOqC,CAAAA,EAAAA,CAAM,CACvD,IAAMtB,CAAAA,CAAAA,CAAAA,CAAUT,EAAI8B,CAAAA,EAAMpC,CAAAA,EAASO,EAAI8B,CAAAA,CAAAA,EAAO,CAAA,CAC9CJ,GAAKlC,CAAAA,CAAKgB,CAAK,EACfmB,CAAAA,EAAKnC,CAAAA,CAAKgB,EAAQ,CAAC,CAAA,CACnBP,CAAAA,EAAKT,CAAAA,CAAKgB,EAAQ,CAAC,CAAA,CACnBoB,IACF,CAGFF,CAAAA,CAAI,KAAK,KAAA,CAAMA,CAAAA,CAAIE,CAAK,CAAA,CACxBD,EAAI,IAAA,CAAK,KAAA,CAAMA,EAAIC,CAAK,CAAA,CACxB3B,EAAI,IAAA,CAAK,KAAA,CAAMA,CAAAA,CAAI2B,CAAK,EAGxB,IAAA,IAASC,CAAAA,CAAK,EAAGA,CAAAA,CAAKJ,CAAAA,EAAa1B,EAAI8B,CAAAA,CAAKnC,CAAAA,CAAQmC,IAClD,IAAA,IAASC,CAAAA,CAAK,EAAGA,CAAAA,CAAKL,CAAAA,EAAazB,EAAI8B,CAAAA,CAAKrC,CAAAA,CAAOqC,IAAM,CACvD,IAAMtB,CAAAA,CAAAA,CAAAA,CAAUT,CAAAA,CAAI8B,GAAMpC,CAAAA,EAASO,CAAAA,CAAI8B,IAAO,CAAA,CAC9CtC,CAAAA,CAAKgB,CAAK,CAAA,CAAIkB,CAAAA,CACdlC,EAAKgB,CAAAA,CAAQ,CAAC,EAAImB,CAAAA,CAClBnC,CAAAA,CAAKgB,EAAQ,CAAC,CAAA,CAAIP,EACpB,CAEJ,CAGF,IAAMU,CAAAA,CAAe,IAAI,SAAA,CAAUlB,CAAAA,CAAOC,CAAM,CAAA,CAChD,OAAAiB,EAAa,IAAA,CAAK,GAAA,CAAInB,CAAI,CAAA,CACnBmB,CACT,CAGA,IAAA,CAAK,SAAA,CAAa,GAAgC,CAChD,GAAI,CACF,GAAM,CAAE,IAAA,CAAAoB,CAAAA,CAAM,UAAArB,CAAAA,CAAW,MAAA,CAAAsB,CAAO,CAAA,CAAI,CAAA,CAAE,KAClCnC,CAAAA,CAEJ,OAAQkC,CAAAA,EACN,KAAK,MAAA,CACHlC,CAAAA,CAASY,EAAUC,CAAS,CAAA,CAC5B,MACF,KAAK,SAAA,CACHb,CAAAA,CAASe,CAAAA,CAAaF,CAAS,CAAA,CAC/B,MACF,KAAK,eAAA,CACHb,CAAAA,CAASgB,EAAmBH,CAAS,CAAA,CACrC,MACF,KAAK,UAAA,CACHb,EAAS2B,CAAAA,CAAcd,CAAAA,CAAWsB,GAAQ,SAAA,EAAa,EAAE,EACzD,MACF,QACE,MAAM,IAAI,MAAM,CAAA,wBAAA,EAA2BD,CAAI,EAAE,CACrD,CAEA,IAAME,CAAAA,CAA2B,CAAE,OAAApC,CAAO,CAAA,CAC1C,KAAK,WAAA,CAAYoC,CAAAA,CAAU,CAACpC,CAAAA,CAAO,IAAA,CAAK,MAAM,CAAC,EACjD,CAAA,MAASqC,CAAAA,CAAO,CACd,IAAMD,CAAAA,CAA2B,CAC/B,MAAA,CAAQ,CAAA,CAAE,KAAK,SAAA,CACf,KAAA,CAAOC,aAAiB,KAAA,CAAQA,CAAAA,CAAM,QAAU,eAClD,CAAA,CACA,KAAK,WAAA,CAAYD,CAAQ,EAC3B,CACF,CAAA","file":"worker.global.js","sourcesContent":["// Web Worker for heavy image processing operations\n// This worker can be used for blur, sharpen, edge detection, and pixelate filters\n\ninterface WorkerTask {\n  type: 'blur' | 'sharpen' | 'edgeDetection' | 'pixelate';\n  imageData: ImageData;\n  params?: any;\n}\n\ninterface WorkerResponse {\n  result: ImageData;\n  error?: string;\n}\n\n// Convolution helper\nfunction convolve(\n  data: Uint8ClampedArray,\n  width: number,\n  height: number,\n  kernel: number[],\n  kernelSize: number\n): Uint8ClampedArray {\n  const result = new Uint8ClampedArray(data.length);\n  const half = Math.floor(kernelSize / 2);\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let r = 0,\n        g = 0,\n        b = 0;\n\n      for (let ky = 0; ky < kernelSize; ky++) {\n        for (let kx = 0; kx < kernelSize; kx++) {\n          const pixelY = Math.min(height - 1, Math.max(0, y + ky - half));\n          const pixelX = Math.min(width - 1, Math.max(0, x + kx - half));\n          const pixelIndex = (pixelY * width + pixelX) * 4;\n          const weight = kernel[ky * kernelSize + kx];\n\n          r += data[pixelIndex] * weight;\n          g += data[pixelIndex + 1] * weight;\n          b += data[pixelIndex + 2] * weight;\n        }\n      }\n\n      const index = (y * width + x) * 4;\n      result[index] = Math.max(0, Math.min(255, r));\n      result[index + 1] = Math.max(0, Math.min(255, g));\n      result[index + 2] = Math.max(0, Math.min(255, b));\n      result[index + 3] = data[index + 3];\n    }\n  }\n\n  return result;\n}\n\nfunction applyBlur(imageData: ImageData): ImageData {\n  const kernel = [1 / 16, 2 / 16, 1 / 16, 2 / 16, 4 / 16, 2 / 16, 1 / 16, 2 / 16, 1 / 16];\n  const result = convolve(imageData.data, imageData.width, imageData.height, kernel, 3);\n  const newImageData = new ImageData(imageData.width, imageData.height);\n  newImageData.data.set(result);\n  return newImageData;\n}\n\nfunction applySharpen(imageData: ImageData): ImageData {\n  const kernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];\n  const result = convolve(imageData.data, imageData.width, imageData.height, kernel, 3);\n  const newImageData = new ImageData(imageData.width, imageData.height);\n  newImageData.data.set(result);\n  return newImageData;\n}\n\nfunction applyEdgeDetection(imageData: ImageData): ImageData {\n  const sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1];\n  const sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1];\n\n  const data = imageData.data;\n  const width = imageData.width;\n  const height = imageData.height;\n  const result = new Uint8ClampedArray(data.length);\n\n  // Convert to grayscale\n  const gray = new Uint8ClampedArray(data.length);\n  for (let i = 0; i < data.length; i += 4) {\n    const grayValue = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;\n    gray[i] = gray[i + 1] = gray[i + 2] = grayValue;\n    gray[i + 3] = data[i + 3];\n  }\n\n  // Apply Sobel\n  for (let y = 1; y < height - 1; y++) {\n    for (let x = 1; x < width - 1; x++) {\n      let gx = 0;\n      let gy = 0;\n\n      for (let ky = -1; ky <= 1; ky++) {\n        for (let kx = -1; kx <= 1; kx++) {\n          const pixelIndex = ((y + ky) * width + (x + kx)) * 4;\n          const kernelIndex = (ky + 1) * 3 + (kx + 1);\n          const pixelValue = gray[pixelIndex];\n\n          gx += pixelValue * sobelX[kernelIndex];\n          gy += pixelValue * sobelY[kernelIndex];\n        }\n      }\n\n      const magnitude = Math.sqrt(gx * gx + gy * gy);\n      const index = (y * width + x) * 4;\n\n      result[index] = result[index + 1] = result[index + 2] = Math.min(255, magnitude);\n      result[index + 3] = data[index + 3];\n    }\n  }\n\n  const newImageData = new ImageData(width, height);\n  newImageData.data.set(result);\n  return newImageData;\n}\n\nfunction applyPixelate(imageData: ImageData, blockSize: number = 10): ImageData {\n  const data = new Uint8ClampedArray(imageData.data);\n  const width = imageData.width;\n  const height = imageData.height;\n\n  for (let y = 0; y < height; y += blockSize) {\n    for (let x = 0; x < width; x += blockSize) {\n      let r = 0,\n        g = 0,\n        b = 0,\n        count = 0;\n\n      // Calculate average\n      for (let dy = 0; dy < blockSize && y + dy < height; dy++) {\n        for (let dx = 0; dx < blockSize && x + dx < width; dx++) {\n          const index = ((y + dy) * width + (x + dx)) * 4;\n          r += data[index];\n          g += data[index + 1];\n          b += data[index + 2];\n          count++;\n        }\n      }\n\n      r = Math.round(r / count);\n      g = Math.round(g / count);\n      b = Math.round(b / count);\n\n      // Fill block\n      for (let dy = 0; dy < blockSize && y + dy < height; dy++) {\n        for (let dx = 0; dx < blockSize && x + dx < width; dx++) {\n          const index = ((y + dy) * width + (x + dx)) * 4;\n          data[index] = r;\n          data[index + 1] = g;\n          data[index + 2] = b;\n        }\n      }\n    }\n  }\n\n  const newImageData = new ImageData(width, height);\n  newImageData.data.set(data);\n  return newImageData;\n}\n\n// Message handler\nself.onmessage = (e: MessageEvent<WorkerTask>) => {\n  try {\n    const { type, imageData, params } = e.data;\n    let result: ImageData;\n\n    switch (type) {\n      case 'blur':\n        result = applyBlur(imageData);\n        break;\n      case 'sharpen':\n        result = applySharpen(imageData);\n        break;\n      case 'edgeDetection':\n        result = applyEdgeDetection(imageData);\n        break;\n      case 'pixelate':\n        result = applyPixelate(imageData, params?.blockSize || 10);\n        break;\n      default:\n        throw new Error(`Unknown operation type: ${type}`);\n    }\n\n    const response: WorkerResponse = { result };\n    self.postMessage(response, [result.data.buffer]);\n  } catch (error) {\n    const response: WorkerResponse = {\n      result: e.data.imageData,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n    self.postMessage(response);\n  }\n};\n\nexport {};\n"]}