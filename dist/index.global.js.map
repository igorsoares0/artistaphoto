{"version":3,"sources":["../src/core/ImageState.ts","../src/core/OperationQueue.ts","../src/errors/ArtistAPhotoError.ts","../src/utils/canvas.ts","../src/core/ImageProcessor.ts","../src/core/LicenseManager.ts","../src/utils/imageLoader.ts","../src/utils/validators.ts","../src/operations/base/Operation.ts","../src/operations/crop/CropOperation.ts","../src/operations/resize/ResizeOperation.ts","../src/operations/text/TextOperation.ts","../src/operations/shape/ShapeOperation.ts","../src/operations/filters/FilterOperation.ts","../src/operations/filters/GrayscaleFilter.ts","../src/utils/color.ts","../src/operations/filters/SepiaFilter.ts","../src/utils/matrix.ts","../src/operations/filters/BlurFilter.ts","../src/operations/filters/SharpenFilter.ts","../src/operations/filters/VintageFilter.ts","../src/operations/filters/InvertFilter.ts","../src/operations/filters/VignetteFilter.ts","../src/operations/filters/PosterizeFilter.ts","../src/operations/filters/PixelateFilter.ts","../src/operations/filters/EdgeDetectionFilter.ts","../src/operations/adjustments/BrightnessAdjustment.ts","../src/operations/adjustments/ContrastAdjustment.ts","../src/operations/adjustments/SaturationAdjustment.ts","../src/operations/adjustments/ExposureAdjustment.ts","../src/operations/adjustments/TemperatureAdjustment.ts","../src/core/ArtistAPhoto.ts","../src/index.ts","../src/workers/workerPool.ts"],"names":["ImageState","init_ImageState","__esmMin","_ImageState","image","imageData","OperationQueue","init_OperationQueue","operation","ArtistAPhotoError","InvalidDimensionsError","InvalidCropError","ImageLoadError","ExportError","CanvasContextError","init_ArtistAPhotoError","_ArtistAPhotoError","message","_InvalidDimensionsError","_InvalidCropError","_ImageLoadError","_ExportError","_CanvasContextError","createCanvas","width","height","canvas","getContext2D","ctx","canvasToBlob","format","quality","resolve","reject","blob","canvasToDataURL","downloadBlob","filename","url","link","applyWatermark","text","fontSize","spacing","diagonal","y","x","init_canvas","ImageProcessor","init_ImageProcessor","state","operations","CACHE_KEY","DEFAULT_STORE_URL","GUMROAD_API_URL","GUMROAD_PRODUCT_IDS","_licenseKey","_licenseInfo","_isValidated","_config","LicenseManager","LicenseError","init_LicenseManager","_LicenseManager","config","key","cached","result","storeUrl","productIds","productId","response","data","purchase","isSubscription","isExpired","error","gumroad","status","expiresAt","isValid","parsed","licenseInfo","cacheDuration","_LicenseError","code","ErrorWithCaptureStackTrace","loadImageFromUrl","img","loadImageFromFile","file","getImageData","init_imageLoader","validateDimensions","MAX_DIMENSION","validateCropParams","params","imageWidth","imageHeight","validateAdjustmentValue","value","min","max","validateFilterIntensity","intensity","init_validators","BaseOperation","init_Operation","CropOperation","init_CropOperation","ResizeOperation","init_ResizeOperation","options","currentImage","tempCanvas","TextOperation","init_TextOperation","_canvas","fontStyle","fontWeight","ShapeOperation","init_ShapeOperation","centerX","centerY","radiusX","radiusY","FilterOperation","init_FilterOperation","GrayscaleFilter","init_GrayscaleFilter","i","gray","clamp","init_color","SepiaFilter","init_SepiaFilter","r","g","b","newR","newG","newB","convolve","kernel","kernelSize","half","ky","kx","pixelY","pixelX","pixelIndex","weight","index","BLUR_KERNEL_3X3","SHARPEN_KERNEL_3X3","SOBEL_X_KERNEL","SOBEL_Y_KERNEL","init_matrix","BlurFilter","init_BlurFilter","radius","blurred","SharpenFilter","init_SharpenFilter","sharpened","VintageFilter","init_VintageFilter","distance","maxDistance","vignette","InvertFilter","init_InvertFilter","VignetteFilter","init_VignetteFilter","strength","factor","originalR","originalG","originalB","PosterizeFilter","init_PosterizeFilter","levels","step","PixelateFilter","init_PixelateFilter","blockSize","original","avgColor","startX","startY","size","count","color","EdgeDetectionFilter","init_EdgeDetectionFilter","grayValue","gx","gy","kernelIndex","pixelValue","magnitude","BrightnessAdjustment","init_BrightnessAdjustment","adjustment","ContrastAdjustment","init_ContrastAdjustment","SaturationAdjustment","init_SaturationAdjustment","ExposureAdjustment","init_ExposureAdjustment","exposure","TemperatureAdjustment","init_TemperatureAdjustment","temp","ArtistAPhoto_exports","__export","ArtistAPhoto","init_ArtistAPhoto","_ArtistAPhoto","type","WorkerPool","maxWorkers","workerCode","worker","checkInterval","task","timeout","e","createEditor","source"],"mappings":"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","file":"index.global.js","sourcesContent":["import type { ImageMetadata } from '../types';\r\n\r\nexport class ImageState {\r\n  readonly originalImage: HTMLImageElement;\r\n  readonly originalImageData: ImageData;\r\n  readonly width: number;\r\n  readonly height: number;\r\n  readonly metadata: ImageMetadata;\r\n\r\n  constructor(image: HTMLImageElement, imageData: ImageData) {\r\n    this.originalImage = image;\r\n    this.originalImageData = imageData;\r\n    this.width = imageData.width;\r\n    this.height = imageData.height;\r\n    this.metadata = {\r\n      createdAt: Date.now(),\r\n      format: 'unknown',\r\n      width: imageData.width,\r\n      height: imageData.height,\r\n    };\r\n  }\r\n\r\n  clone(): ImageState {\r\n    return new ImageState(this.originalImage, this.originalImageData);\r\n  }\r\n}\r\n","import type { Operation } from '../operations/base/Operation';\r\n\r\nexport class OperationQueue {\r\n  private operations: Operation[] = [];\r\n  private currentIndex: number = -1;\r\n\r\n  enqueue(operation: Operation): void {\r\n    // Remove \"future\" operations if any when adding new operation\r\n    this.operations = this.operations.slice(0, this.currentIndex + 1);\r\n    this.operations.push(operation);\r\n    this.currentIndex++;\r\n  }\r\n\r\n  undo(): void {\r\n    if (this.canUndo()) {\r\n      this.currentIndex--;\r\n    }\r\n  }\r\n\r\n  redo(): void {\r\n    if (this.canRedo()) {\r\n      this.currentIndex++;\r\n    }\r\n  }\r\n\r\n  getActiveOperations(): ReadonlyArray<Operation> {\r\n    return this.operations.slice(0, this.currentIndex + 1);\r\n  }\r\n\r\n  getAllOperations(): ReadonlyArray<Operation> {\r\n    return this.operations;\r\n  }\r\n\r\n  canUndo(): boolean {\r\n    return this.currentIndex >= 0;\r\n  }\r\n\r\n  canRedo(): boolean {\r\n    return this.currentIndex < this.operations.length - 1;\r\n  }\r\n\r\n  clear(): void {\r\n    this.operations = [];\r\n    this.currentIndex = -1;\r\n  }\r\n\r\n  reset(): void {\r\n    this.currentIndex = -1;\r\n  }\r\n}\r\n","export class ArtistAPhotoError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'ArtistAPhotoError';\r\n    Object.setPrototypeOf(this, ArtistAPhotoError.prototype);\r\n  }\r\n}\r\n\r\nexport class InvalidDimensionsError extends ArtistAPhotoError {\r\n  constructor(message: string = 'Invalid dimensions') {\r\n    super(message);\r\n    this.name = 'InvalidDimensionsError';\r\n    Object.setPrototypeOf(this, InvalidDimensionsError.prototype);\r\n  }\r\n}\r\n\r\nexport class InvalidCropError extends ArtistAPhotoError {\r\n  constructor(message: string = 'Invalid crop parameters') {\r\n    super(message);\r\n    this.name = 'InvalidCropError';\r\n    Object.setPrototypeOf(this, InvalidCropError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImageLoadError extends ArtistAPhotoError {\r\n  constructor(message: string = 'Failed to load image') {\r\n    super(message);\r\n    this.name = 'ImageLoadError';\r\n    Object.setPrototypeOf(this, ImageLoadError.prototype);\r\n  }\r\n}\r\n\r\nexport class ExportError extends ArtistAPhotoError {\r\n  constructor(message: string = 'Failed to export image') {\r\n    super(message);\r\n    this.name = 'ExportError';\r\n    Object.setPrototypeOf(this, ExportError.prototype);\r\n  }\r\n}\r\n\r\nexport class CanvasContextError extends ArtistAPhotoError {\r\n  constructor(message: string = 'Failed to get canvas context') {\r\n    super(message);\r\n    this.name = 'CanvasContextError';\r\n    Object.setPrototypeOf(this, CanvasContextError.prototype);\r\n  }\r\n}\r\n","import { CanvasContextError, ExportError } from '../errors/ArtistAPhotoError';\r\nimport type { ExportFormat } from '../types';\r\n\r\nexport function createCanvas(width: number, height: number): HTMLCanvasElement {\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  return canvas;\r\n}\r\n\r\nexport function getContext2D(canvas: HTMLCanvasElement): CanvasRenderingContext2D {\r\n  const ctx = canvas.getContext('2d', { willReadFrequently: true });\r\n  if (!ctx) {\r\n    throw new CanvasContextError('Failed to get 2D context');\r\n  }\r\n  return ctx;\r\n}\r\n\r\nexport function canvasToBlob(\r\n  canvas: HTMLCanvasElement,\r\n  format: ExportFormat = 'image/png',\r\n  quality?: number\r\n): Promise<Blob> {\r\n  return new Promise((resolve, reject) => {\r\n    canvas.toBlob(\r\n      (blob) => {\r\n        if (blob) {\r\n          resolve(blob);\r\n        } else {\r\n          reject(new ExportError('Failed to create blob from canvas'));\r\n        }\r\n      },\r\n      format,\r\n      quality\r\n    );\r\n  });\r\n}\r\n\r\nexport function canvasToDataURL(\r\n  canvas: HTMLCanvasElement,\r\n  format: ExportFormat = 'image/png',\r\n  quality?: number\r\n): string {\r\n  return canvas.toDataURL(format, quality);\r\n}\r\n\r\nexport function downloadBlob(blob: Blob, filename: string): void {\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nexport function applyWatermark(canvas: HTMLCanvasElement): void {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) return;\r\n\r\n  const text = 'ArtistAPhoto - UNLICENSED';\r\n  const fontSize = Math.max(16, Math.floor(canvas.width * 0.03));\r\n\r\n  ctx.save();\r\n\r\n  ctx.font = `bold ${fontSize}px Arial, sans-serif`;\r\n  ctx.fillStyle = 'rgba(128, 128, 128, 0.3)';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  const textWidth = ctx.measureText(text).width;\r\n  const spacing = textWidth * 1.5;\r\n  const diagonal = Math.sqrt(canvas.width ** 2 + canvas.height ** 2);\r\n\r\n  ctx.translate(canvas.width / 2, canvas.height / 2);\r\n  ctx.rotate(-Math.PI / 4);\r\n\r\n  for (let y = -diagonal; y < diagonal; y += spacing * 0.6) {\r\n    for (let x = -diagonal; x < diagonal; x += spacing) {\r\n      ctx.fillText(text, x, y);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n","import { createCanvas, getContext2D } from '../utils/canvas';\r\nimport type { ImageState } from './ImageState';\r\nimport type { Operation } from '../operations/base/Operation';\r\n\r\nexport class ImageProcessor {\r\n  private canvas: HTMLCanvasElement;\r\n  private ctx: CanvasRenderingContext2D;\r\n\r\n  constructor() {\r\n    this.canvas = createCanvas(1, 1);\r\n    this.ctx = getContext2D(this.canvas);\r\n  }\r\n\r\n  async execute(\r\n    state: ImageState,\r\n    operations: ReadonlyArray<Operation>\r\n  ): Promise<HTMLCanvasElement> {\r\n    // Set up canvas with original image\r\n    this.canvas.width = state.width;\r\n    this.canvas.height = state.height;\r\n    this.ctx.drawImage(state.originalImage, 0, 0);\r\n\r\n    // Apply operations sequentially\r\n    for (const operation of operations) {\r\n      await operation.apply(this.canvas, this.ctx);\r\n    }\r\n\r\n    return this.canvas;\r\n  }\r\n\r\n  getCanvas(): HTMLCanvasElement {\r\n    return this.canvas;\r\n  }\r\n\r\n  getContext(): CanvasRenderingContext2D {\r\n    return this.ctx;\r\n  }\r\n}\r\n","import type {\r\n  LicenseInfo,\r\n  LicenseValidationResult,\r\n  LicenseConfig,\r\n  LicenseStatus,\r\n} from '../types';\r\n\r\nconst CACHE_KEY = 'artistaphoto_license_cache';\r\nconst DEFAULT_CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours\r\nconst DEFAULT_STORE_URL = 'https://srsigor.gumroad.com';\r\nconst GUMROAD_API_URL = 'https://api.gumroad.com/v2/licenses/verify';\r\n\r\n// Your Gumroad Product IDs (get these from your Gumroad product settings)\r\n// Add both Solo and Team product IDs here\r\nconst GUMROAD_PRODUCT_IDS = [\r\n  'R4Nv9B5P5-9sdVR3E3ytdg==',  // Solo plan\r\n  '3i7epkgA3v0HK0r_UghsZg==',  // Team plan\r\n];\r\n\r\ninterface CachedLicense {\r\n  licenseInfo: LicenseInfo;\r\n  validatedAt: number;\r\n  expiresAt: number;\r\n}\r\n\r\n// Use module-level variables instead of static class properties for better consistency\r\nlet _licenseKey: string | null = null;\r\nlet _licenseInfo: LicenseInfo | null = null;\r\nlet _isValidated: boolean = false;\r\nlet _config: LicenseConfig = {\r\n  productIds: GUMROAD_PRODUCT_IDS,\r\n  storeUrl: DEFAULT_STORE_URL,\r\n  cacheDuration: DEFAULT_CACHE_DURATION,\r\n  enableCache: true,\r\n};\r\n\r\nexport class LicenseManager {\r\n  /**\r\n   * Configure the license manager\r\n   * @param config - Configuration options including productId (required for validation)\r\n   */\r\n  static configure(config: Partial<LicenseConfig>): void {\r\n    _config = { ..._config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Set and validate a license key\r\n   * @param key - The license key from Gumroad\r\n   * @returns Promise<LicenseInfo> - Information about the validated license\r\n   * @throws Error if license is invalid\r\n   */\r\n  static async setLicenseKey(key: string): Promise<LicenseInfo> {\r\n    if (!key || typeof key !== 'string') {\r\n      throw new LicenseError('License key is required', 'INVALID_KEY');\r\n    }\r\n\r\n    _licenseKey = key.trim();\r\n\r\n    // Check cache first\r\n    if (_config.enableCache) {\r\n      const cached = LicenseManager.getFromCache();\r\n      if (cached && cached.licenseInfo.key === _licenseKey) {\r\n        _licenseInfo = cached.licenseInfo;\r\n        _isValidated = true;\r\n        return _licenseInfo;\r\n      }\r\n    }\r\n\r\n    // Validate with Gumroad\r\n    const result = await LicenseManager.validateWithGumroad(_licenseKey);\r\n\r\n    if (!result.valid) {\r\n      _isValidated = false;\r\n      _licenseInfo = null;\r\n      throw LicenseManager.createErrorFromResult(result);\r\n    }\r\n\r\n    // Parse license info\r\n    _licenseInfo = LicenseManager.parseLicenseInfo(_licenseKey, result);\r\n    _isValidated = true;\r\n\r\n    // Cache the result\r\n    if (_config.enableCache) {\r\n      LicenseManager.saveToCache(_licenseInfo);\r\n    }\r\n\r\n    return _licenseInfo;\r\n  }\r\n\r\n  /**\r\n   * Check if a valid license is active\r\n   */\r\n  static isLicenseValid(): boolean {\r\n    return _isValidated && _licenseInfo !== null && _licenseInfo.isValid;\r\n  }\r\n\r\n  /**\r\n   * Get current license information\r\n   */\r\n  static getLicenseInfo(): LicenseInfo | null {\r\n    return _licenseInfo;\r\n  }\r\n\r\n  /**\r\n   * Get the current license key\r\n   */\r\n  static getLicenseKey(): string | null {\r\n    return _licenseKey;\r\n  }\r\n\r\n  /**\r\n   * Verify license is valid, throw if not\r\n   * Call this before any SDK operation\r\n   */\r\n  static requireValidLicense(): void {\r\n    if (!LicenseManager.isLicenseValid()) {\r\n      const storeUrl = _config.storeUrl || DEFAULT_STORE_URL;\r\n      throw new LicenseError(\r\n        `License key required. Call ArtistAPhoto.setLicenseKey() first.\\n` +\r\n        `Purchase a license at: ${storeUrl}`,\r\n        'LICENSE_REQUIRED'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the current license (logout)\r\n   */\r\n  static clearLicense(): void {\r\n    _licenseKey = null;\r\n    _licenseInfo = null;\r\n    _isValidated = false;\r\n    LicenseManager.clearCache();\r\n  }\r\n\r\n  /**\r\n   * Refresh the license validation (force re-validation)\r\n   */\r\n  static async refreshLicense(): Promise<LicenseInfo> {\r\n    if (!_licenseKey) {\r\n      throw new LicenseError('No license key set', 'NO_LICENSE');\r\n    }\r\n\r\n    LicenseManager.clearCache();\r\n    return LicenseManager.setLicenseKey(_licenseKey);\r\n  }\r\n\r\n  // ==================== Private Methods ====================\r\n\r\n  private static async validateWithGumroad(key: string): Promise<LicenseValidationResult> {\r\n    try {\r\n      // Get product IDs from config or use defaults\r\n      const productIds = _config.productIds || GUMROAD_PRODUCT_IDS;\r\n\r\n      // Try validating with each product ID\r\n      // This allows a license key to work with both Solo and Team plans\r\n      for (const productId of productIds) {\r\n        try {\r\n          const response = await fetch(GUMROAD_API_URL, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n            body: new URLSearchParams({\r\n              product_id: productId,\r\n              license_key: key,\r\n            }),\r\n          });\r\n\r\n          if (!response.ok) {\r\n            continue; // Try next product ID\r\n          }\r\n\r\n          const data = await response.json();\r\n\r\n          // Gumroad returns { success: true/false, purchase: {...} }\r\n          if (!data.success) {\r\n            continue; // Try next product ID\r\n          }\r\n\r\n          // Check if subscription is active\r\n          const purchase = data.purchase;\r\n          const isSubscription = !!purchase.subscription_id;\r\n          let isExpired = false;\r\n\r\n          if (isSubscription) {\r\n            // Check if subscription ended\r\n            if (purchase.subscription_ended_at) {\r\n              isExpired = new Date(purchase.subscription_ended_at) < new Date();\r\n            }\r\n            // If no end date, subscription is active\r\n          }\r\n\r\n          const isValid = data.success && !isExpired;\r\n\r\n          // If valid with this product ID, return success\r\n          if (isValid) {\r\n            return {\r\n              valid: true,\r\n              gumroadResponse: data,\r\n            };\r\n          }\r\n\r\n          // If expired, return error (don't try other products)\r\n          if (isExpired) {\r\n            return {\r\n              valid: false,\r\n              gumroadResponse: data,\r\n              error: 'Subscription has expired',\r\n            };\r\n          }\r\n        } catch {\r\n          // If this product ID fails, try next one\r\n          continue;\r\n        }\r\n      }\r\n\r\n      // If none of the product IDs worked, return error\r\n      return {\r\n        valid: false,\r\n        error: 'License key not found',\r\n      };\r\n    } catch (error) {\r\n      // If network error and we have cache, use cache\r\n      if (_config.enableCache) {\r\n        const cached = LicenseManager.getFromCache();\r\n        if (cached && cached.licenseInfo.key === key) {\r\n          return {\r\n            valid: true,\r\n            gumroadResponse: undefined,\r\n          };\r\n        }\r\n      }\r\n\r\n      return {\r\n        valid: false,\r\n        error: `Network error: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  private static parseLicenseInfo(key: string, result: LicenseValidationResult): LicenseInfo {\r\n    const gumroad = result.gumroadResponse;\r\n\r\n    if (!gumroad || !gumroad.purchase) {\r\n      // Fallback for cached response without gumroadResponse\r\n      return {\r\n        key,\r\n        status: 'active',\r\n        isValid: true,\r\n        expiresAt: null,\r\n        activationLimit: null,\r\n        activationUsage: 0,\r\n        usageLimit: null,\r\n        usage: 0,\r\n      };\r\n    }\r\n\r\n    const purchase = gumroad.purchase;\r\n    let status: LicenseStatus = 'active';\r\n    let expiresAt: string | null = null;\r\n\r\n    // Check if it's a subscription\r\n    if (purchase.subscription_id) {\r\n      if (purchase.subscription_ended_at) {\r\n        const endDate = new Date(purchase.subscription_ended_at);\r\n        if (endDate < new Date()) {\r\n          status = 'expired';\r\n        }\r\n        expiresAt = purchase.subscription_ended_at;\r\n      }\r\n      // If subscription has no end date, it's active\r\n    }\r\n\r\n    // Check if purchase was refunded or chargebacked\r\n    if (purchase.refunded || purchase.chargebacked) {\r\n      status = 'revoked';\r\n    }\r\n\r\n    const isValid = result.valid === true;\r\n\r\n    return {\r\n      key,\r\n      status: isValid ? 'active' : status,\r\n      isValid: isValid,\r\n      expiresAt: expiresAt,\r\n      activationLimit: null, // Gumroad doesn't have activation limits\r\n      activationUsage: 0,\r\n      usageLimit: null,\r\n      usage: 0,\r\n      customerEmail: purchase.email,\r\n      customerName: purchase.full_name,\r\n      productName: purchase.product_name,\r\n    };\r\n  }\r\n\r\n  private static createErrorFromResult(result: LicenseValidationResult): LicenseError {\r\n    const storeUrl = _config.storeUrl || DEFAULT_STORE_URL;\r\n\r\n    if (result.error?.includes('expired')) {\r\n      return new LicenseError(\r\n        `Your license has expired.\\n` +\r\n        `Renew at: ${storeUrl}\\n` +\r\n        `Need help? Contact support.`,\r\n        'LICENSE_EXPIRED'\r\n      );\r\n    }\r\n\r\n    if (result.error?.includes('revoked')) {\r\n      return new LicenseError(\r\n        `This license has been revoked.\\n` +\r\n        `Contact support for assistance.`,\r\n        'LICENSE_REVOKED'\r\n      );\r\n    }\r\n\r\n    if (result.error?.includes('disabled')) {\r\n      return new LicenseError(\r\n        `This license has been disabled.\\n` +\r\n        `Contact support for assistance.`,\r\n        'LICENSE_DISABLED'\r\n      );\r\n    }\r\n\r\n    if (result.error?.includes('not found')) {\r\n      return new LicenseError(\r\n        `License key not found.\\n` +\r\n        `Purchase a valid license at: ${storeUrl}`,\r\n        'INVALID_KEY'\r\n      );\r\n    }\r\n\r\n    return new LicenseError(\r\n      `Invalid license key.\\n` +\r\n      `Purchase a valid license at: ${storeUrl}`,\r\n      'INVALID_KEY'\r\n    );\r\n  }\r\n\r\n  // ==================== Cache Methods ====================\r\n\r\n  private static getFromCache(): CachedLicense | null {\r\n    try {\r\n      if (typeof localStorage === 'undefined') {\r\n        return null;\r\n      }\r\n\r\n      const cached = localStorage.getItem(CACHE_KEY);\r\n      if (!cached) {\r\n        return null;\r\n      }\r\n\r\n      const parsed: CachedLicense = JSON.parse(cached);\r\n\r\n      // Check if cache is still valid\r\n      if (Date.now() > parsed.expiresAt) {\r\n        LicenseManager.clearCache();\r\n        return null;\r\n      }\r\n\r\n      return parsed;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private static saveToCache(licenseInfo: LicenseInfo): void {\r\n    try {\r\n      if (typeof localStorage === 'undefined') {\r\n        return;\r\n      }\r\n\r\n      const cacheDuration = _config.cacheDuration || DEFAULT_CACHE_DURATION;\r\n\r\n      const cached: CachedLicense = {\r\n        licenseInfo,\r\n        validatedAt: Date.now(),\r\n        expiresAt: Date.now() + cacheDuration,\r\n      };\r\n\r\n      localStorage.setItem(CACHE_KEY, JSON.stringify(cached));\r\n    } catch {\r\n      // Ignore localStorage errors (private browsing, etc.)\r\n    }\r\n  }\r\n\r\n  private static clearCache(): void {\r\n    try {\r\n      if (typeof localStorage !== 'undefined') {\r\n        localStorage.removeItem(CACHE_KEY);\r\n      }\r\n    } catch {\r\n      // Ignore errors\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Custom error class for license-related errors\r\n */\r\nexport class LicenseError extends Error {\r\n  code: string;\r\n\r\n  constructor(message: string, code: string) {\r\n    super(message);\r\n    this.name = 'LicenseError';\r\n    this.code = code;\r\n\r\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\r\n    const ErrorWithCaptureStackTrace = Error as typeof Error & {\r\n      captureStackTrace?: (targetObject: object, constructorOpt?: Function) => void;\r\n    };\r\n    if (ErrorWithCaptureStackTrace.captureStackTrace) {\r\n      ErrorWithCaptureStackTrace.captureStackTrace(this, LicenseError);\r\n    }\r\n  }\r\n}\r\n","import { ImageLoadError } from '../errors/ArtistAPhotoError';\r\nimport { createCanvas, getContext2D } from './canvas';\r\n\r\nexport async function loadImageFromUrl(url: string): Promise<HTMLImageElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => resolve(img);\r\n    img.onerror = () => reject(new ImageLoadError(`Failed to load image from ${url}`));\r\n    img.src = url;\r\n  });\r\n}\r\n\r\nexport async function loadImageFromFile(file: File): Promise<HTMLImageElement> {\r\n  const url = URL.createObjectURL(file);\r\n  try {\r\n    const img = await loadImageFromUrl(url);\r\n    return img;\r\n  } finally {\r\n    URL.revokeObjectURL(url);\r\n  }\r\n}\r\n\r\nexport function getImageData(img: HTMLImageElement): ImageData {\r\n  const canvas = createCanvas(img.width, img.height);\r\n  const ctx = getContext2D(canvas);\r\n  ctx.drawImage(img, 0, 0);\r\n  return ctx.getImageData(0, 0, img.width, img.height);\r\n}\r\n\r\nexport function imageDataToCanvas(imageData: ImageData): HTMLCanvasElement {\r\n  const canvas = createCanvas(imageData.width, imageData.height);\r\n  const ctx = getContext2D(canvas);\r\n  ctx.putImageData(imageData, 0, 0);\r\n  return canvas;\r\n}\r\n","import { InvalidDimensionsError, InvalidCropError } from '../errors/ArtistAPhotoError';\r\nimport type { CropOptions } from '../types';\r\n\r\nconst MAX_DIMENSION = 16384;\r\n\r\nexport function validateDimensions(width: number, height: number): void {\r\n  if (width <= 0 || height <= 0) {\r\n    throw new InvalidDimensionsError('Dimensions must be positive numbers');\r\n  }\r\n  if (width > MAX_DIMENSION || height > MAX_DIMENSION) {\r\n    throw new InvalidDimensionsError(\r\n      `Dimensions exceed maximum size (${MAX_DIMENSION}x${MAX_DIMENSION})`\r\n    );\r\n  }\r\n}\r\n\r\nexport function validateCropParams(\r\n  params: CropOptions,\r\n  imageWidth: number,\r\n  imageHeight: number\r\n): void {\r\n  const { x, y, width, height } = params;\r\n\r\n  if (x < 0 || y < 0) {\r\n    throw new InvalidCropError('Crop coordinates must be non-negative');\r\n  }\r\n  if (width <= 0 || height <= 0) {\r\n    throw new InvalidCropError('Crop dimensions must be positive');\r\n  }\r\n  if (x + width > imageWidth || y + height > imageHeight) {\r\n    throw new InvalidCropError('Crop area exceeds image bounds');\r\n  }\r\n}\r\n\r\nexport function validateAdjustmentValue(\r\n  value: number,\r\n  min: number = -100,\r\n  max: number = 100\r\n): number {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nexport function validateFilterIntensity(intensity: number = 1.0): number {\r\n  return Math.max(0, Math.min(1, intensity));\r\n}\r\n","import type { OperationType, OperationParams } from '../../types';\r\n\r\nexport interface Operation {\r\n  readonly type: OperationType;\r\n  readonly params: OperationParams;\r\n\r\n  apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void>;\r\n  validate(): boolean;\r\n}\r\n\r\nexport abstract class BaseOperation implements Operation {\r\n  abstract readonly type: OperationType;\r\n  abstract readonly params: OperationParams;\r\n\r\n  abstract apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void>;\r\n\r\n  validate(): boolean {\r\n    return true;\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport type { CropOptions } from '../../types';\r\n\r\nexport class CropOperation extends BaseOperation {\r\n  readonly type = 'crop' as const;\r\n  readonly params: CropOptions;\r\n\r\n  constructor(params: CropOptions) {\r\n    super();\r\n    this.params = params;\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const { x, y, width, height } = this.params;\r\n\r\n    // Get cropped image data\r\n    const imageData = ctx.getImageData(x, y, width, height);\r\n\r\n    // Resize canvas to cropped dimensions\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    // Draw cropped image\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n\r\n  validate(): boolean {\r\n    const { x, y, width, height } = this.params;\r\n    return x >= 0 && y >= 0 && width > 0 && height > 0;\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { createCanvas, getContext2D } from '../../utils/canvas';\r\nimport type { ResizeParams, ResizeOptions } from '../../types';\r\n\r\nexport class ResizeOperation extends BaseOperation {\r\n  readonly type = 'resize' as const;\r\n  readonly params: ResizeParams;\r\n\r\n  constructor(width: number, height: number, options?: ResizeOptions) {\r\n    super();\r\n    this.params = {\r\n      width,\r\n      height,\r\n      quality: options?.quality || 'high',\r\n      maintainAspectRatio: options?.maintainAspectRatio ?? true,\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const { width, height, quality } = this.params;\r\n\r\n    // Store current image\r\n    const currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const tempCanvas = createCanvas(canvas.width, canvas.height);\r\n    const tempCtx = getContext2D(tempCanvas);\r\n    tempCtx.putImageData(currentImage, 0, 0);\r\n\r\n    // Resize canvas\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    // Set image smoothing based on quality\r\n    ctx.imageSmoothingEnabled = quality === 'high' || quality === 'medium';\r\n    ctx.imageSmoothingQuality = quality === 'high' ? 'high' : quality === 'medium' ? 'medium' : 'low';\r\n\r\n    // Draw resized image\r\n    ctx.drawImage(tempCanvas, 0, 0, width, height);\r\n  }\r\n\r\n  validate(): boolean {\r\n    const { width, height } = this.params;\r\n    return width > 0 && height > 0;\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport type { TextOptions, TextParams } from '../../types';\r\n\r\nexport class TextOperation extends BaseOperation {\r\n  readonly type = 'text' as const;\r\n  readonly params: TextParams;\r\n\r\n  constructor(options: TextOptions) {\r\n    super();\r\n    this.params = {\r\n      text: options.text,\r\n      x: options.x,\r\n      y: options.y,\r\n      fontSize: options.fontSize || 24,\r\n      fontFamily: options.fontFamily || 'Arial',\r\n      color: options.color || '#000000',\r\n      align: options.align || 'left',\r\n      baseline: options.baseline || 'alphabetic',\r\n      maxWidth: options.maxWidth || 0,\r\n      bold: options.bold || false,\r\n      italic: options.italic || false,\r\n      rotation: options.rotation || 0,\r\n      stroke: options.stroke,\r\n      shadow: options.shadow,\r\n    };\r\n  }\r\n\r\n  async apply(_canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    ctx.save();\r\n\r\n    // Apply rotation if needed\r\n    if (this.params.rotation !== 0) {\r\n      ctx.translate(this.params.x, this.params.y);\r\n      ctx.rotate((this.params.rotation * Math.PI) / 180);\r\n      ctx.translate(-this.params.x, -this.params.y);\r\n    }\r\n\r\n    // Configure font\r\n    const fontStyle = this.params.italic ? 'italic' : 'normal';\r\n    const fontWeight = this.params.bold ? 'bold' : 'normal';\r\n    ctx.font = `${fontStyle} ${fontWeight} ${this.params.fontSize}px ${this.params.fontFamily}`;\r\n    ctx.textAlign = this.params.align;\r\n    ctx.textBaseline = this.params.baseline;\r\n\r\n    // Apply shadow if provided\r\n    if (this.params.shadow) {\r\n      ctx.shadowColor = this.params.shadow.color;\r\n      ctx.shadowBlur = this.params.shadow.blur;\r\n      ctx.shadowOffsetX = this.params.shadow.offsetX;\r\n      ctx.shadowOffsetY = this.params.shadow.offsetY;\r\n    }\r\n\r\n    // Draw text stroke if provided\r\n    if (this.params.stroke) {\r\n      ctx.strokeStyle = this.params.stroke.color;\r\n      ctx.lineWidth = this.params.stroke.width;\r\n      if (this.params.maxWidth > 0) {\r\n        ctx.strokeText(this.params.text, this.params.x, this.params.y, this.params.maxWidth);\r\n      } else {\r\n        ctx.strokeText(this.params.text, this.params.x, this.params.y);\r\n      }\r\n    }\r\n\r\n    // Draw text fill\r\n    ctx.fillStyle = this.params.color;\r\n    if (this.params.maxWidth > 0) {\r\n      ctx.fillText(this.params.text, this.params.x, this.params.y, this.params.maxWidth);\r\n    } else {\r\n      ctx.fillText(this.params.text, this.params.x, this.params.y);\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  validate(): boolean {\r\n    return (\r\n      this.params.text.length > 0 &&\r\n      this.params.fontSize > 0 &&\r\n      this.params.x >= 0 &&\r\n      this.params.y >= 0\r\n    );\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport type { ShapeOptions, ShapeParams } from '../../types';\r\n\r\nexport class ShapeOperation extends BaseOperation {\r\n  readonly type = 'shape' as const;\r\n  readonly params: ShapeParams;\r\n\r\n  constructor(options: ShapeOptions) {\r\n    super();\r\n    this.params = {\r\n      type: options.type,\r\n      x: options.x,\r\n      y: options.y,\r\n      width: options.width,\r\n      height: options.height,\r\n      fill: options.fill,\r\n      stroke: options.stroke,\r\n      rotation: options.rotation || 0,\r\n    };\r\n  }\r\n\r\n  async apply(_canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    ctx.save();\r\n\r\n    // Apply rotation if needed\r\n    if (this.params.rotation !== 0) {\r\n      const centerX = this.params.x + this.params.width / 2;\r\n      const centerY = this.params.y + this.params.height / 2;\r\n      ctx.translate(centerX, centerY);\r\n      ctx.rotate((this.params.rotation * Math.PI) / 180);\r\n      ctx.translate(-centerX, -centerY);\r\n    }\r\n\r\n    // Draw shape based on type\r\n    if (this.params.type === 'rectangle') {\r\n      this.drawRectangle(ctx);\r\n    } else if (this.params.type === 'ellipse') {\r\n      this.drawEllipse(ctx);\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  private drawRectangle(ctx: CanvasRenderingContext2D): void {\r\n    // Draw fill if provided\r\n    if (this.params.fill) {\r\n      ctx.fillStyle = this.params.fill;\r\n      ctx.fillRect(this.params.x, this.params.y, this.params.width, this.params.height);\r\n    }\r\n\r\n    // Draw stroke if provided\r\n    if (this.params.stroke) {\r\n      ctx.strokeStyle = this.params.stroke.color;\r\n      ctx.lineWidth = this.params.stroke.width;\r\n      ctx.strokeRect(this.params.x, this.params.y, this.params.width, this.params.height);\r\n    }\r\n  }\r\n\r\n  private drawEllipse(ctx: CanvasRenderingContext2D): void {\r\n    const centerX = this.params.x + this.params.width / 2;\r\n    const centerY = this.params.y + this.params.height / 2;\r\n    const radiusX = this.params.width / 2;\r\n    const radiusY = this.params.height / 2;\r\n\r\n    ctx.beginPath();\r\n    ctx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, 2 * Math.PI);\r\n\r\n    // Draw fill if provided\r\n    if (this.params.fill) {\r\n      ctx.fillStyle = this.params.fill;\r\n      ctx.fill();\r\n    }\r\n\r\n    // Draw stroke if provided\r\n    if (this.params.stroke) {\r\n      ctx.strokeStyle = this.params.stroke.color;\r\n      ctx.lineWidth = this.params.stroke.width;\r\n      ctx.stroke();\r\n    }\r\n  }\r\n\r\n  validate(): boolean {\r\n    return (\r\n      this.params.width > 0 &&\r\n      this.params.height > 0 &&\r\n      this.params.x >= 0 &&\r\n      this.params.y >= 0 &&\r\n      (this.params.type === 'rectangle' || this.params.type === 'ellipse')\r\n    );\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateFilterIntensity } from '../../utils/validators';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport abstract class FilterOperation extends BaseOperation {\r\n  readonly type = 'filter' as const;\r\n  protected intensity: number;\r\n  abstract readonly params: FilterParams;\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super();\r\n    this.intensity = validateFilterIntensity(intensity);\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n\r\n    // Apply filter to each pixel\r\n    this.applyFilter(data, canvas.width, canvas.height);\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n\r\n  protected abstract applyFilter(\r\n    data: Uint8ClampedArray,\r\n    width: number,\r\n    height: number\r\n  ): void;\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport class GrayscaleFilter extends FilterOperation {\r\n  readonly params: FilterParams = { filterType: 'grayscale' };\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'grayscale', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray): void {\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      // Luminance formula: 0.299R + 0.587G + 0.114B\r\n      const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;\r\n\r\n      // Apply intensity (blend with original)\r\n      data[i] = data[i] * (1 - this.intensity) + gray * this.intensity;\r\n      data[i + 1] = data[i + 1] * (1 - this.intensity) + gray * this.intensity;\r\n      data[i + 2] = data[i + 2] * (1 - this.intensity) + gray * this.intensity;\r\n    }\r\n  }\r\n}\r\n","export function rgbToHsl(r: number, g: number, b: number): [number, number, number] {\r\n  r /= 255;\r\n  g /= 255;\r\n  b /= 255;\r\n\r\n  const max = Math.max(r, g, b);\r\n  const min = Math.min(r, g, b);\r\n  let h = 0;\r\n  let s = 0;\r\n  const l = (max + min) / 2;\r\n\r\n  if (max !== min) {\r\n    const d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n    switch (max) {\r\n      case r:\r\n        h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\r\n        break;\r\n      case g:\r\n        h = ((b - r) / d + 2) / 6;\r\n        break;\r\n      case b:\r\n        h = ((r - g) / d + 4) / 6;\r\n        break;\r\n    }\r\n  }\r\n\r\n  return [h * 360, s * 100, l * 100];\r\n}\r\n\r\nexport function hslToRgb(h: number, s: number, l: number): [number, number, number] {\r\n  h /= 360;\r\n  s /= 100;\r\n  l /= 100;\r\n\r\n  let r: number, g: number, b: number;\r\n\r\n  if (s === 0) {\r\n    r = g = b = l;\r\n  } else {\r\n    const hue2rgb = (p: number, q: number, t: number): number => {\r\n      if (t < 0) t += 1;\r\n      if (t > 1) t -= 1;\r\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n      if (t < 1 / 2) return q;\r\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n      return p;\r\n    };\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n\r\n    r = hue2rgb(p, q, h + 1 / 3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1 / 3);\r\n  }\r\n\r\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n}\r\n\r\nexport function clamp(value: number, min: number = 0, max: number = 255): number {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { clamp } from '../../utils/color';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport class SepiaFilter extends FilterOperation {\r\n  readonly params: FilterParams = { filterType: 'sepia' };\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'sepia', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray): void {\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const r = data[i];\r\n      const g = data[i + 1];\r\n      const b = data[i + 2];\r\n\r\n      // Sepia transformation matrix\r\n      const newR = r * 0.393 + g * 0.769 + b * 0.189;\r\n      const newG = r * 0.349 + g * 0.686 + b * 0.168;\r\n      const newB = r * 0.272 + g * 0.534 + b * 0.131;\r\n\r\n      // Apply intensity (blend with original)\r\n      data[i] = clamp(data[i] * (1 - this.intensity) + newR * this.intensity);\r\n      data[i + 1] = clamp(data[i + 1] * (1 - this.intensity) + newG * this.intensity);\r\n      data[i + 2] = clamp(data[i + 2] * (1 - this.intensity) + newB * this.intensity);\r\n    }\r\n  }\r\n}\r\n","export function convolve(\r\n  data: Uint8ClampedArray,\r\n  width: number,\r\n  height: number,\r\n  kernel: number[],\r\n  kernelSize: number\r\n): Uint8ClampedArray {\r\n  const result = new Uint8ClampedArray(data.length);\r\n  const half = Math.floor(kernelSize / 2);\r\n\r\n  for (let y = 0; y < height; y++) {\r\n    for (let x = 0; x < width; x++) {\r\n      let r = 0,\r\n        g = 0,\r\n        b = 0;\r\n\r\n      for (let ky = 0; ky < kernelSize; ky++) {\r\n        for (let kx = 0; kx < kernelSize; kx++) {\r\n          const pixelY = Math.min(height - 1, Math.max(0, y + ky - half));\r\n          const pixelX = Math.min(width - 1, Math.max(0, x + kx - half));\r\n          const pixelIndex = (pixelY * width + pixelX) * 4;\r\n          const weight = kernel[ky * kernelSize + kx];\r\n\r\n          r += data[pixelIndex] * weight;\r\n          g += data[pixelIndex + 1] * weight;\r\n          b += data[pixelIndex + 2] * weight;\r\n        }\r\n      }\r\n\r\n      const index = (y * width + x) * 4;\r\n      result[index] = Math.max(0, Math.min(255, r));\r\n      result[index + 1] = Math.max(0, Math.min(255, g));\r\n      result[index + 2] = Math.max(0, Math.min(255, b));\r\n      result[index + 3] = data[index + 3]; // Preserve alpha\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport const BLUR_KERNEL_3X3 = [1 / 16, 2 / 16, 1 / 16, 2 / 16, 4 / 16, 2 / 16, 1 / 16, 2 / 16, 1 / 16];\r\n\r\nexport const SHARPEN_KERNEL_3X3 = [0, -1, 0, -1, 5, -1, 0, -1, 0];\r\n\r\nexport const SOBEL_X_KERNEL = [-1, 0, 1, -2, 0, 2, -1, 0, 1];\r\n\r\nexport const SOBEL_Y_KERNEL = [-1, -2, -1, 0, 0, 0, 1, 2, 1];\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { convolve, BLUR_KERNEL_3X3 } from '../../utils/matrix';\r\nimport type { BlurParams } from '../../types';\r\n\r\nexport class BlurFilter extends FilterOperation {\r\n  readonly params: BlurParams;\r\n\r\n  constructor(intensity: number = 1.0, radius: number = 1) {\r\n    super(intensity);\r\n    this.params = { filterType: 'blur', intensity: this.intensity, radius };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    // Apply Gaussian blur using convolution\r\n    const blurred = convolve(data, width, height, BLUR_KERNEL_3X3, 3);\r\n\r\n    // Apply intensity (blend with original)\r\n    for (let i = 0; i < data.length; i++) {\r\n      if ((i + 1) % 4 !== 0) {\r\n        // Skip alpha channel\r\n        data[i] = data[i] * (1 - this.intensity) + blurred[i] * this.intensity;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { convolve, SHARPEN_KERNEL_3X3 } from '../../utils/matrix';\r\nimport type { SharpenParams } from '../../types';\r\n\r\nexport class SharpenFilter extends FilterOperation {\r\n  readonly params: SharpenParams;\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'sharpen', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    // Apply sharpen using convolution\r\n    const sharpened = convolve(data, width, height, SHARPEN_KERNEL_3X3, 3);\r\n\r\n    // Apply intensity (blend with original)\r\n    for (let i = 0; i < data.length; i++) {\r\n      if ((i + 1) % 4 !== 0) {\r\n        // Skip alpha channel\r\n        data[i] = data[i] * (1 - this.intensity) + sharpened[i] * this.intensity;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { clamp } from '../../utils/color';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport class VintageFilter extends FilterOperation {\r\n  readonly params: FilterParams;\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'vintage', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const i = (y * width + x) * 4;\r\n        const r = data[i];\r\n        const g = data[i + 1];\r\n        const b = data[i + 2];\r\n\r\n        // Warm sepia-like tone\r\n        let newR = r * 0.9 + 30;\r\n        let newG = g * 0.85 + 10;\r\n        let newB = b * 0.7;\r\n\r\n        // Reduce saturation slightly\r\n        const gray = (newR + newG + newB) / 3;\r\n        newR = newR * 0.8 + gray * 0.2;\r\n        newG = newG * 0.8 + gray * 0.2;\r\n        newB = newB * 0.8 + gray * 0.2;\r\n\r\n        // Apply vignette (darker at edges)\r\n        const centerX = width / 2;\r\n        const centerY = height / 2;\r\n        const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));\r\n        const maxDistance = Math.sqrt(Math.pow(centerX, 2) + Math.pow(centerY, 2));\r\n        const vignette = 1 - (distance / maxDistance) * 0.5;\r\n\r\n        newR *= vignette;\r\n        newG *= vignette;\r\n        newB *= vignette;\r\n\r\n        // Apply intensity (blend with original)\r\n        data[i] = clamp(data[i] * (1 - this.intensity) + newR * this.intensity);\r\n        data[i + 1] = clamp(data[i + 1] * (1 - this.intensity) + newG * this.intensity);\r\n        data[i + 2] = clamp(data[i + 2] * (1 - this.intensity) + newB * this.intensity);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport class InvertFilter extends FilterOperation {\r\n  readonly params: FilterParams = { filterType: 'invert' };\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'invert', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray): void {\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = data[i] * (1 - this.intensity) + (255 - data[i]) * this.intensity;\r\n      data[i + 1] = data[i + 1] * (1 - this.intensity) + (255 - data[i + 1]) * this.intensity;\r\n      data[i + 2] = data[i + 2] * (1 - this.intensity) + (255 - data[i + 2]) * this.intensity;\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport type { VignetteParams } from '../../types';\r\n\r\nexport class VignetteFilter extends FilterOperation {\r\n  readonly params: VignetteParams;\r\n\r\n  constructor(intensity: number = 1.0, strength: number = 0.5) {\r\n    super(intensity);\r\n    this.params = {\r\n      filterType: 'vignette',\r\n      intensity: this.intensity,\r\n      strength: Math.max(0, Math.min(1, strength)),\r\n    };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    const centerX = width / 2;\r\n    const centerY = height / 2;\r\n    const maxDistance = Math.sqrt(centerX * centerX + centerY * centerY);\r\n    const strength = this.params.strength || 0.5;\r\n\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));\r\n        const vignette = 1 - (distance / maxDistance) * strength;\r\n        const factor = Math.max(0, Math.min(1, vignette));\r\n\r\n        const index = (y * width + x) * 4;\r\n        const originalR = data[index];\r\n        const originalG = data[index + 1];\r\n        const originalB = data[index + 2];\r\n\r\n        // Apply vignette with intensity\r\n        data[index] = originalR * (1 - this.intensity) + originalR * factor * this.intensity;\r\n        data[index + 1] = originalG * (1 - this.intensity) + originalG * factor * this.intensity;\r\n        data[index + 2] = originalB * (1 - this.intensity) + originalB * factor * this.intensity;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { clamp } from '../../utils/color';\r\nimport type { PosterizeParams } from '../../types';\r\n\r\nexport class PosterizeFilter extends FilterOperation {\r\n  readonly params: PosterizeParams;\r\n\r\n  constructor(intensity: number = 1.0, levels: number = 4) {\r\n    super(intensity);\r\n    this.params = {\r\n      filterType: 'posterize',\r\n      intensity: this.intensity,\r\n      levels: Math.max(2, Math.min(16, Math.floor(levels))),\r\n    };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray): void {\r\n    const levels = this.params.levels || 4;\r\n    const step = 255 / (levels - 1);\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const r = data[i];\r\n      const g = data[i + 1];\r\n      const b = data[i + 2];\r\n\r\n      // Quantize each channel\r\n      const newR = Math.round(r / step) * step;\r\n      const newG = Math.round(g / step) * step;\r\n      const newB = Math.round(b / step) * step;\r\n\r\n      // Apply intensity (blend with original)\r\n      data[i] = clamp(data[i] * (1 - this.intensity) + newR * this.intensity);\r\n      data[i + 1] = clamp(data[i + 1] * (1 - this.intensity) + newG * this.intensity);\r\n      data[i + 2] = clamp(data[i + 2] * (1 - this.intensity) + newB * this.intensity);\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport type { PixelateParams } from '../../types';\r\n\r\nexport class PixelateFilter extends FilterOperation {\r\n  readonly params: PixelateParams;\r\n\r\n  constructor(intensity: number = 1.0, blockSize: number = 10) {\r\n    super(intensity);\r\n    this.params = {\r\n      filterType: 'pixelate',\r\n      intensity: this.intensity,\r\n      blockSize: Math.max(1, Math.floor(blockSize)),\r\n    };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    const blockSize = this.params.blockSize || 10;\r\n    const original = new Uint8ClampedArray(data);\r\n\r\n    for (let y = 0; y < height; y += blockSize) {\r\n      for (let x = 0; x < width; x += blockSize) {\r\n        // Calculate average color of the block\r\n        const avgColor = this.getBlockAverage(original, x, y, blockSize, width, height);\r\n\r\n        // Fill block with average color\r\n        this.fillBlock(data, original, x, y, blockSize, width, height, avgColor);\r\n      }\r\n    }\r\n  }\r\n\r\n  private getBlockAverage(\r\n    data: Uint8ClampedArray,\r\n    startX: number,\r\n    startY: number,\r\n    size: number,\r\n    width: number,\r\n    height: number\r\n  ): [number, number, number] {\r\n    let r = 0,\r\n      g = 0,\r\n      b = 0,\r\n      count = 0;\r\n\r\n    for (let y = startY; y < Math.min(startY + size, height); y++) {\r\n      for (let x = startX; x < Math.min(startX + size, width); x++) {\r\n        const index = (y * width + x) * 4;\r\n        r += data[index];\r\n        g += data[index + 1];\r\n        b += data[index + 2];\r\n        count++;\r\n      }\r\n    }\r\n\r\n    return [Math.round(r / count), Math.round(g / count), Math.round(b / count)];\r\n  }\r\n\r\n  private fillBlock(\r\n    data: Uint8ClampedArray,\r\n    original: Uint8ClampedArray,\r\n    startX: number,\r\n    startY: number,\r\n    size: number,\r\n    width: number,\r\n    height: number,\r\n    color: [number, number, number]\r\n  ): void {\r\n    const [r, g, b] = color;\r\n\r\n    for (let y = startY; y < Math.min(startY + size, height); y++) {\r\n      for (let x = startX; x < Math.min(startX + size, width); x++) {\r\n        const index = (y * width + x) * 4;\r\n\r\n        // Apply intensity (blend with original)\r\n        data[index] = original[index] * (1 - this.intensity) + r * this.intensity;\r\n        data[index + 1] = original[index + 1] * (1 - this.intensity) + g * this.intensity;\r\n        data[index + 2] = original[index + 2] * (1 - this.intensity) + b * this.intensity;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { FilterOperation } from './FilterOperation';\r\nimport { SOBEL_X_KERNEL, SOBEL_Y_KERNEL } from '../../utils/matrix';\r\nimport { clamp } from '../../utils/color';\r\nimport type { FilterParams } from '../../types';\r\n\r\nexport class EdgeDetectionFilter extends FilterOperation {\r\n  readonly params: FilterParams;\r\n\r\n  constructor(intensity: number = 1.0) {\r\n    super(intensity);\r\n    this.params = { filterType: 'edgeDetection', intensity: this.intensity };\r\n  }\r\n\r\n  protected applyFilter(data: Uint8ClampedArray, width: number, height: number): void {\r\n    // Convert to grayscale first\r\n    const gray = new Uint8ClampedArray(data.length);\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const grayValue = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;\r\n      gray[i] = gray[i + 1] = gray[i + 2] = grayValue;\r\n      gray[i + 3] = data[i + 3];\r\n    }\r\n\r\n    // Apply Sobel operator\r\n    const result = this.applySobel(gray, width, height);\r\n\r\n    // Apply intensity (blend with original)\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = data[i] * (1 - this.intensity) + result[i] * this.intensity;\r\n      data[i + 1] = data[i + 1] * (1 - this.intensity) + result[i + 1] * this.intensity;\r\n      data[i + 2] = data[i + 2] * (1 - this.intensity) + result[i + 2] * this.intensity;\r\n    }\r\n  }\r\n\r\n  private applySobel(data: Uint8ClampedArray, width: number, height: number): Uint8ClampedArray {\r\n    const result = new Uint8ClampedArray(data.length);\r\n\r\n    for (let y = 1; y < height - 1; y++) {\r\n      for (let x = 1; x < width - 1; x++) {\r\n        let gx = 0;\r\n        let gy = 0;\r\n\r\n        // Apply Sobel kernels\r\n        for (let ky = -1; ky <= 1; ky++) {\r\n          for (let kx = -1; kx <= 1; kx++) {\r\n            const pixelIndex = ((y + ky) * width + (x + kx)) * 4;\r\n            const kernelIndex = (ky + 1) * 3 + (kx + 1);\r\n            const pixelValue = data[pixelIndex];\r\n\r\n            gx += pixelValue * SOBEL_X_KERNEL[kernelIndex];\r\n            gy += pixelValue * SOBEL_Y_KERNEL[kernelIndex];\r\n          }\r\n        }\r\n\r\n        // Calculate magnitude\r\n        const magnitude = Math.sqrt(gx * gx + gy * gy);\r\n        const index = (y * width + x) * 4;\r\n\r\n        result[index] = result[index + 1] = result[index + 2] = clamp(magnitude);\r\n        result[index + 3] = data[index + 3]; // Preserve alpha\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateAdjustmentValue } from '../../utils/validators';\r\nimport { clamp } from '../../utils/color';\r\nimport type { AdjustmentParams } from '../../types';\r\n\r\nexport class BrightnessAdjustment extends BaseOperation {\r\n  readonly type = 'adjustment' as const;\r\n  readonly params: AdjustmentParams;\r\n\r\n  constructor(value: number) {\r\n    super();\r\n    this.params = {\r\n      adjustment: 'brightness',\r\n      value: validateAdjustmentValue(value),\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n    const adjustment = this.params.value * 2.55; // Convert to 0-255 scale\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = clamp(data[i] + adjustment);\r\n      data[i + 1] = clamp(data[i + 1] + adjustment);\r\n      data[i + 2] = clamp(data[i + 2] + adjustment);\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateAdjustmentValue } from '../../utils/validators';\r\nimport { clamp } from '../../utils/color';\r\nimport type { AdjustmentParams } from '../../types';\r\n\r\nexport class ContrastAdjustment extends BaseOperation {\r\n  readonly type = 'adjustment' as const;\r\n  readonly params: AdjustmentParams;\r\n\r\n  constructor(value: number) {\r\n    super();\r\n    this.params = {\r\n      adjustment: 'contrast',\r\n      value: validateAdjustmentValue(value),\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n\r\n    // Convert value to contrast factor: -100 to 100 -> 0 to 2+\r\n    const factor = (259 * (this.params.value + 255)) / (255 * (259 - this.params.value));\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = clamp(factor * (data[i] - 128) + 128);\r\n      data[i + 1] = clamp(factor * (data[i + 1] - 128) + 128);\r\n      data[i + 2] = clamp(factor * (data[i + 2] - 128) + 128);\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateAdjustmentValue } from '../../utils/validators';\r\nimport { clamp } from '../../utils/color';\r\nimport type { AdjustmentParams } from '../../types';\r\n\r\nexport class SaturationAdjustment extends BaseOperation {\r\n  readonly type = 'adjustment' as const;\r\n  readonly params: AdjustmentParams;\r\n\r\n  constructor(value: number) {\r\n    super();\r\n    this.params = {\r\n      adjustment: 'saturation',\r\n      value: validateAdjustmentValue(value),\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n\r\n    // Convert to saturation factor: -100 to 100 -> 0 to 2\r\n    const factor = (this.params.value + 100) / 100;\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const r = data[i];\r\n      const g = data[i + 1];\r\n      const b = data[i + 2];\r\n\r\n      // Convert to grayscale for luminance\r\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\r\n\r\n      // Adjust saturation\r\n      data[i] = clamp(gray + factor * (r - gray));\r\n      data[i + 1] = clamp(gray + factor * (g - gray));\r\n      data[i + 2] = clamp(gray + factor * (b - gray));\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateAdjustmentValue } from '../../utils/validators';\r\nimport { clamp } from '../../utils/color';\r\nimport type { AdjustmentParams } from '../../types';\r\n\r\nexport class ExposureAdjustment extends BaseOperation {\r\n  readonly type = 'adjustment' as const;\r\n  readonly params: AdjustmentParams;\r\n\r\n  constructor(value: number) {\r\n    super();\r\n    this.params = {\r\n      adjustment: 'exposure',\r\n      value: validateAdjustmentValue(value),\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n\r\n    // Exposure adjustment using gamma correction\r\n    const exposure = this.params.value / 100; // -1 to 1\r\n    const factor = Math.pow(2, exposure);\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = clamp(data[i] * factor);\r\n      data[i + 1] = clamp(data[i + 1] * factor);\r\n      data[i + 2] = clamp(data[i + 2] * factor);\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n","import { BaseOperation } from '../base/Operation';\r\nimport { validateAdjustmentValue } from '../../utils/validators';\r\nimport { clamp } from '../../utils/color';\r\nimport type { AdjustmentParams } from '../../types';\r\n\r\nexport class TemperatureAdjustment extends BaseOperation {\r\n  readonly type = 'adjustment' as const;\r\n  readonly params: AdjustmentParams;\r\n\r\n  constructor(value: number) {\r\n    super();\r\n    this.params = {\r\n      adjustment: 'temperature',\r\n      value: validateAdjustmentValue(value),\r\n    };\r\n  }\r\n\r\n  async apply(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): Promise<void> {\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    const data = imageData.data;\r\n\r\n    const temp = this.params.value / 100; // -1 to 1\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      if (temp > 0) {\r\n        // Warmer: increase red, decrease blue\r\n        data[i] = clamp(data[i] + temp * 40);\r\n        data[i + 2] = clamp(data[i + 2] - temp * 40);\r\n      } else {\r\n        // Cooler: decrease red, increase blue\r\n        data[i] = clamp(data[i] + temp * 40);\r\n        data[i + 2] = clamp(data[i + 2] - temp * 40);\r\n      }\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n","import { ImageState } from './ImageState';\r\nimport { OperationQueue } from './OperationQueue';\r\nimport { ImageProcessor } from './ImageProcessor';\r\nimport { LicenseManager, LicenseError } from './LicenseManager';\r\nimport { loadImageFromUrl, loadImageFromFile, getImageData } from '../utils/imageLoader';\r\nimport { canvasToBlob, canvasToDataURL, downloadBlob, applyWatermark } from '../utils/canvas';\r\nimport { validateCropParams, validateDimensions } from '../utils/validators';\r\nimport { CropOperation } from '../operations/crop/CropOperation';\r\nimport { ResizeOperation } from '../operations/resize/ResizeOperation';\r\nimport { TextOperation } from '../operations/text/TextOperation';\r\nimport { ShapeOperation } from '../operations/shape/ShapeOperation';\r\nimport { GrayscaleFilter } from '../operations/filters/GrayscaleFilter';\r\nimport { SepiaFilter } from '../operations/filters/SepiaFilter';\r\nimport { BlurFilter } from '../operations/filters/BlurFilter';\r\nimport { SharpenFilter } from '../operations/filters/SharpenFilter';\r\nimport { VintageFilter } from '../operations/filters/VintageFilter';\r\nimport { InvertFilter } from '../operations/filters/InvertFilter';\r\nimport { VignetteFilter } from '../operations/filters/VignetteFilter';\r\nimport { PosterizeFilter } from '../operations/filters/PosterizeFilter';\r\nimport { PixelateFilter } from '../operations/filters/PixelateFilter';\r\nimport { EdgeDetectionFilter } from '../operations/filters/EdgeDetectionFilter';\r\nimport { BrightnessAdjustment } from '../operations/adjustments/BrightnessAdjustment';\r\nimport { ContrastAdjustment } from '../operations/adjustments/ContrastAdjustment';\r\nimport { SaturationAdjustment } from '../operations/adjustments/SaturationAdjustment';\r\nimport { ExposureAdjustment } from '../operations/adjustments/ExposureAdjustment';\r\nimport { TemperatureAdjustment } from '../operations/adjustments/TemperatureAdjustment';\r\nimport type { Operation } from '../operations/base/Operation';\r\nimport type {\r\n  CropOptions,\r\n  ResizeOptions,\r\n  FilterType,\r\n  ExportFormat,\r\n  TextOptions,\r\n  ShapeOptions,\r\n  LicenseInfo,\r\n  LicenseConfig,\r\n} from '../types';\r\n\r\n// Re-export LicenseError for consumers\r\nexport { LicenseError };\r\n\r\nexport class ArtistAPhoto {\r\n  private state: ImageState;\r\n  private operationQueue: OperationQueue;\r\n  private processor: ImageProcessor;\r\n\r\n  private constructor(state: ImageState) {\r\n    this.state = state;\r\n    this.operationQueue = new OperationQueue();\r\n    this.processor = new ImageProcessor();\r\n  }\r\n\r\n  // ==================== License Management (Static Methods) ====================\r\n\r\n  /**\r\n   * Configure the SDK license settings\r\n   * @param config - License configuration options\r\n   * @example\r\n   * ```typescript\r\n   * ArtistAPhoto.configure({\r\n   *   storeUrl: 'https://yourstore.lemonsqueezy.com',\r\n   *   cacheDuration: 24 * 60 * 60 * 1000, // 24 hours\r\n   *   enableCache: true\r\n   * });\r\n   * ```\r\n   */\r\n  static configure(config: Partial<LicenseConfig>): void {\r\n    LicenseManager.configure(config);\r\n  }\r\n\r\n  /**\r\n   * Set and validate a license key\r\n   * Must be called before using any SDK functionality\r\n   * @param key - The license key from Lemon Squeezy\r\n   * @returns Promise<LicenseInfo> - Information about the validated license\r\n   * @throws LicenseError if the license is invalid, expired, or activation limit reached\r\n   * @example\r\n   * ```typescript\r\n   * try {\r\n   *   const licenseInfo = await ArtistAPhoto.setLicenseKey('APH-XXXX-XXXX-XXXX');\r\n   *   console.log('License activated:', licenseInfo.productName);\r\n   * } catch (error) {\r\n   *   if (error instanceof LicenseError) {\r\n   *     console.error('License error:', error.code, error.message);\r\n   *   }\r\n   * }\r\n   * ```\r\n   */\r\n  static async setLicenseKey(key: string): Promise<LicenseInfo> {\r\n    return LicenseManager.setLicenseKey(key);\r\n  }\r\n\r\n  /**\r\n   * Check if a valid license is currently active\r\n   * @returns boolean - true if a valid license is active\r\n   */\r\n  static isLicenseValid(): boolean {\r\n    return LicenseManager.isLicenseValid();\r\n  }\r\n\r\n  /**\r\n   * Get information about the current license\r\n   * @returns LicenseInfo | null - License details or null if no license is set\r\n   */\r\n  static getLicenseInfo(): LicenseInfo | null {\r\n    return LicenseManager.getLicenseInfo();\r\n  }\r\n\r\n  /**\r\n   * Clear the current license (logout)\r\n   * Removes the license from memory and cache\r\n   */\r\n  static clearLicense(): void {\r\n    LicenseManager.clearLicense();\r\n  }\r\n\r\n  /**\r\n   * Force refresh the license validation\r\n   * Useful after renewal or to check for updates\r\n   * @returns Promise<LicenseInfo> - Updated license information\r\n   */\r\n  static async refreshLicense(): Promise<LicenseInfo> {\r\n    return LicenseManager.refreshLicense();\r\n  }\r\n\r\n  // ==================== Factory Methods ====================\r\n\r\n  /**\r\n   * Create an editor instance from an image URL\r\n   * @param url - The URL of the image to load\r\n   * @returns Promise<ArtistAPhoto> - Editor instance\r\n   * @throws LicenseError if no valid license is set\r\n   */\r\n  static async fromUrl(url: string): Promise<ArtistAPhoto> {\r\n    const img = await loadImageFromUrl(url);\r\n    const imageData = getImageData(img);\r\n    const state = new ImageState(img, imageData);\r\n    return new ArtistAPhoto(state);\r\n  }\r\n\r\n  /**\r\n   * Create an editor instance from a File object\r\n   * @param file - The File object (from file input)\r\n   * @returns Promise<ArtistAPhoto> - Editor instance\r\n   * @throws LicenseError if no valid license is set\r\n   */\r\n  static async fromFile(file: File): Promise<ArtistAPhoto> {\r\n    const img = await loadImageFromFile(file);\r\n    const imageData = getImageData(img);\r\n    const state = new ImageState(img, imageData);\r\n    return new ArtistAPhoto(state);\r\n  }\r\n\r\n  /**\r\n   * Create an editor instance from an existing canvas\r\n   * @param canvas - The HTMLCanvasElement to use\r\n   * @returns Promise<ArtistAPhoto> - Editor instance\r\n   * @throws LicenseError if no valid license is set\r\n   */\r\n  static async fromCanvas(canvas: HTMLCanvasElement): Promise<ArtistAPhoto> {\r\n    const img = new Image();\r\n    img.src = canvas.toDataURL();\r\n    await new Promise((resolve) => (img.onload = resolve));\r\n    const imageData = getImageData(img);\r\n    const state = new ImageState(img, imageData);\r\n    return new ArtistAPhoto(state);\r\n  }\r\n\r\n  /**\r\n   * Create an editor instance from an existing image element\r\n   * @param img - The HTMLImageElement to use\r\n   * @returns Promise<ArtistAPhoto> - Editor instance\r\n   * @throws LicenseError if no valid license is set\r\n   */\r\n  static async fromImageElement(img: HTMLImageElement): Promise<ArtistAPhoto> {\r\n    const imageData = getImageData(img);\r\n    const state = new ImageState(img, imageData);\r\n    return new ArtistAPhoto(state);\r\n  }\r\n\r\n  // ==================== Transformation Operations ====================\r\n\r\n  crop(options: CropOptions): this {\r\n    validateCropParams(options, this.state.width, this.state.height);\r\n    const operation = new CropOperation(options);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  resize(width: number, height: number, options?: ResizeOptions): this {\r\n    validateDimensions(width, height);\r\n    const operation = new ResizeOperation(width, height, options);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  addText(options: TextOptions): this {\r\n    const operation = new TextOperation(options);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  addShape(options: ShapeOptions): this {\r\n    const operation = new ShapeOperation(options);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  // ==================== Filter Operations ====================\r\n\r\n  filter(type: FilterType, intensity: number = 1.0): this {\r\n    let operation: Operation;\r\n\r\n    switch (type) {\r\n      case 'grayscale':\r\n        operation = new GrayscaleFilter(intensity);\r\n        break;\r\n      case 'sepia':\r\n        operation = new SepiaFilter(intensity);\r\n        break;\r\n      case 'blur':\r\n        operation = new BlurFilter(intensity);\r\n        break;\r\n      case 'sharpen':\r\n        operation = new SharpenFilter(intensity);\r\n        break;\r\n      case 'vintage':\r\n        operation = new VintageFilter(intensity);\r\n        break;\r\n      case 'invert':\r\n        operation = new InvertFilter(intensity);\r\n        break;\r\n      case 'vignette':\r\n        operation = new VignetteFilter(intensity);\r\n        break;\r\n      case 'posterize':\r\n        operation = new PosterizeFilter(intensity);\r\n        break;\r\n      case 'pixelate':\r\n        operation = new PixelateFilter(intensity);\r\n        break;\r\n      case 'edgeDetection':\r\n        operation = new EdgeDetectionFilter(intensity);\r\n        break;\r\n    }\r\n\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  // ==================== Adjustment Operations ====================\r\n\r\n  brightness(value: number): this {\r\n    const operation = new BrightnessAdjustment(value);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  contrast(value: number): this {\r\n    const operation = new ContrastAdjustment(value);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  saturation(value: number): this {\r\n    const operation = new SaturationAdjustment(value);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  exposure(value: number): this {\r\n    const operation = new ExposureAdjustment(value);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  temperature(value: number): this {\r\n    const operation = new TemperatureAdjustment(value);\r\n    this.operationQueue.enqueue(operation);\r\n    return this;\r\n  }\r\n\r\n  // ==================== Undo/Redo Operations ====================\r\n\r\n  undo(): this {\r\n    this.operationQueue.undo();\r\n    return this;\r\n  }\r\n\r\n  redo(): this {\r\n    this.operationQueue.redo();\r\n    return this;\r\n  }\r\n\r\n  canUndo(): boolean {\r\n    return this.operationQueue.canUndo();\r\n  }\r\n\r\n  canRedo(): boolean {\r\n    return this.operationQueue.canRedo();\r\n  }\r\n\r\n  getHistory(): ReadonlyArray<Operation> {\r\n    return this.operationQueue.getAllOperations();\r\n  }\r\n\r\n  // ==================== State Management ====================\r\n\r\n  reset(): this {\r\n    this.operationQueue.reset();\r\n    return this;\r\n  }\r\n\r\n  getOriginal(): ImageData {\r\n    return this.state.originalImageData;\r\n  }\r\n\r\n  async preview(): Promise<HTMLCanvasElement> {\r\n    const operations = this.operationQueue.getActiveOperations();\r\n    return await this.processor.execute(this.state, operations);\r\n  }\r\n\r\n  // ==================== Export Operations ====================\r\n\r\n  async toCanvas(): Promise<HTMLCanvasElement> {\r\n    return await this.preview();\r\n  }\r\n\r\n  async toBlob(format?: ExportFormat, quality?: number): Promise<Blob> {\r\n    const canvas = await this.toCanvas();\r\n    if (!LicenseManager.isLicenseValid()) {\r\n      applyWatermark(canvas);\r\n    }\r\n    return await canvasToBlob(canvas, format, quality);\r\n  }\r\n\r\n  async toDataURL(format?: ExportFormat, quality?: number): Promise<string> {\r\n    const canvas = await this.toCanvas();\r\n    if (!LicenseManager.isLicenseValid()) {\r\n      applyWatermark(canvas);\r\n    }\r\n    return canvasToDataURL(canvas, format, quality);\r\n  }\r\n\r\n  async download(filename: string, format?: ExportFormat, quality?: number): Promise<void> {\r\n    const blob = await this.toBlob(format, quality);\r\n    downloadBlob(blob, filename);\r\n  }\r\n}\r\n","// Main SDK class\r\nexport { ArtistAPhoto, LicenseError } from './core/ArtistAPhoto';\r\n\r\n// Export all types\r\nexport type {\r\n  FilterType,\r\n  ExportFormat,\r\n  CropOptions,\r\n  ResizeOptions,\r\n  ImageMetadata,\r\n  ExportOptions,\r\n  AdjustmentType,\r\n  AdjustmentParams,\r\n  FilterParams,\r\n  OperationType,\r\n  TextOptions,\r\n  TextParams,\r\n  ShapeType,\r\n  ShapeOptions,\r\n  ShapeParams,\r\n  // License types\r\n  LicenseStatus,\r\n  LicenseInfo,\r\n  LicenseConfig,\r\n  LicenseValidationResult,\r\n} from './types';\r\n\r\n// Export errors\r\nexport {\r\n  ArtistAPhotoError,\r\n  InvalidDimensionsError,\r\n  InvalidCropError,\r\n  ImageLoadError,\r\n  ExportError,\r\n  CanvasContextError,\r\n} from './errors/ArtistAPhotoError';\r\n\r\n// Export worker pool for advanced usage\r\nexport { WorkerPool } from './workers/workerPool';\r\nexport type { WorkerTask, WorkerResponse } from './workers/workerPool';\r\n\r\n// Convenience factory function\r\nexport async function createEditor(\r\n  source: string | File | HTMLImageElement | HTMLCanvasElement\r\n): Promise<import('./core/ArtistAPhoto').ArtistAPhoto> {\r\n  const { ArtistAPhoto } = await import('./core/ArtistAPhoto');\r\n\r\n  if (typeof source === 'string') {\r\n    return ArtistAPhoto.fromUrl(source);\r\n  } else if (source instanceof File) {\r\n    return ArtistAPhoto.fromFile(source);\r\n  } else if (source instanceof HTMLImageElement) {\r\n    return ArtistAPhoto.fromImageElement(source);\r\n  } else if (source instanceof HTMLCanvasElement) {\r\n    return ArtistAPhoto.fromCanvas(source);\r\n  }\r\n\r\n  throw new Error('Unsupported source type');\r\n}\r\n","export interface WorkerTask {\r\n  type: string;\r\n  imageData: ImageData;\r\n  params?: any;\r\n}\r\n\r\nexport interface WorkerResponse {\r\n  result: ImageData;\r\n  error?: string;\r\n}\r\n\r\nexport class WorkerPool {\r\n  private workers: Worker[] = [];\r\n  private availableWorkers: Worker[] = [];\r\n  private maxWorkers: number;\r\n  private workerUrl: string | null = null;\r\n\r\n  constructor(maxWorkers?: number) {\r\n    this.maxWorkers = maxWorkers || navigator.hardwareConcurrency || 4;\r\n  }\r\n\r\n  private createWorker(): Worker {\r\n    if (!this.workerUrl) {\r\n      // Create worker from blob if worker file is not available\r\n      const workerCode = `\r\n        // Inline worker code would go here\r\n        // For now, this is a placeholder\r\n        self.onmessage = function(e) {\r\n          self.postMessage({ result: e.data.imageData });\r\n        };\r\n      `;\r\n      const blob = new Blob([workerCode], { type: 'application/javascript' });\r\n      this.workerUrl = URL.createObjectURL(blob);\r\n    }\r\n\r\n    const worker = new Worker(this.workerUrl);\r\n    this.workers.push(worker);\r\n    return worker;\r\n  }\r\n\r\n  private async getAvailableWorker(): Promise<Worker> {\r\n    if (this.availableWorkers.length > 0) {\r\n      return this.availableWorkers.pop()!;\r\n    }\r\n\r\n    if (this.workers.length < this.maxWorkers) {\r\n      return this.createWorker();\r\n    }\r\n\r\n    // Wait for a worker to become available\r\n    return new Promise((resolve) => {\r\n      const checkInterval = setInterval(() => {\r\n        if (this.availableWorkers.length > 0) {\r\n          clearInterval(checkInterval);\r\n          resolve(this.availableWorkers.pop()!);\r\n        }\r\n      }, 10);\r\n    });\r\n  }\r\n\r\n  private releaseWorker(worker: Worker): void {\r\n    this.availableWorkers.push(worker);\r\n  }\r\n\r\n  async execute<T = WorkerResponse>(task: WorkerTask): Promise<T> {\r\n    const worker = await this.getAvailableWorker();\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => {\r\n        this.releaseWorker(worker);\r\n        reject(new Error('Worker timeout'));\r\n      }, 30000); // 30 second timeout\r\n\r\n      worker.onmessage = (e: MessageEvent<T>) => {\r\n        clearTimeout(timeout);\r\n        this.releaseWorker(worker);\r\n        resolve(e.data);\r\n      };\r\n\r\n      worker.onerror = (error) => {\r\n        clearTimeout(timeout);\r\n        this.releaseWorker(worker);\r\n        reject(error);\r\n      };\r\n\r\n      worker.postMessage(task);\r\n    });\r\n  }\r\n\r\n  terminate(): void {\r\n    this.workers.forEach((worker) => worker.terminate());\r\n    this.workers = [];\r\n    this.availableWorkers = [];\r\n\r\n    if (this.workerUrl) {\r\n      URL.revokeObjectURL(this.workerUrl);\r\n      this.workerUrl = null;\r\n    }\r\n  }\r\n}\r\n"]}